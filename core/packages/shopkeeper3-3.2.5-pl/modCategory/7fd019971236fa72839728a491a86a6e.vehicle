<?php return array (
  'unique_key' => 'category',
  'preserve_keys' => false,
  'update_object' => true,
  'related_objects' => 
  array (
    'Chunks' => 
    array (
      '65bf2790bfd0a95529083f58c27c0da9' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopCartRow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<tr class=\\"cart-order\\">\\n    <td align=\\"left\\"><b><a href=\\"[[+url]]\\">[[+name]]<\\/a><\\/b> [[+addit_data]]<\\/td>\\n    <td>[[+price]] [[+currency]]<\\/td>\\n    <td>\\n        <input class=\\"shk-count\\" type=\\"text\\" size=\\"2\\" name=\\"count[]\\" maxlength=\\"3\\" title=\\"\\u0438\\u0437\\u043c\\u0435\\u043d\\u0438\\u0442\\u044c \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e\\" value=\\"[[+count]]\\" \\/>\\n    <\\/td>\\n    <td align=\\"right\\">\\n        <a href=\\"[[+url_del_item]]\\" title=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" class=\\"shk-del\\"><img src=\\"assets\\/components\\/shopkeeper3\\/web\\/css\\/default\\/delete.gif\\" width=\\"17\\" height=\\"17\\" alt=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" \\/><\\/a>\\n    <\\/td>\\n<\\/tr>","locked":0,"properties":null,"static":0,"static_file":"","content":"<tr class=\\"cart-order\\">\\n    <td align=\\"left\\"><b><a href=\\"[[+url]]\\">[[+name]]<\\/a><\\/b> [[+addit_data]]<\\/td>\\n    <td>[[+price]] [[+currency]]<\\/td>\\n    <td>\\n        <input class=\\"shk-count\\" type=\\"text\\" size=\\"2\\" name=\\"count[]\\" maxlength=\\"3\\" title=\\"\\u0438\\u0437\\u043c\\u0435\\u043d\\u0438\\u0442\\u044c \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e\\" value=\\"[[+count]]\\" \\/>\\n    <\\/td>\\n    <td align=\\"right\\">\\n        <a href=\\"[[+url_del_item]]\\" title=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" class=\\"shk-del\\"><img src=\\"assets\\/components\\/shopkeeper3\\/web\\/css\\/default\\/delete.gif\\" width=\\"17\\" height=\\"17\\" alt=\\"\\u0423\\u0434\\u0430\\u043b\\u0438\\u0442\\u044c\\" \\/><\\/a>\\n    <\\/td>\\n<\\/tr>"}',
        'guid' => '92100db0d7ba3726b661f17b01c8afa9',
        'native_key' => NULL,
        'signature' => 'e27bc45fa5eb316fa3f0fe68a1f602aa',
      ),
      '69398efc68a5abc1379a465ae9d843a0' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopCart","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<div class=\\"shop-cart\\" data-shopcart=\\"2\\">\\n    <div class=\\"shop-cart-head\\"><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"empty\\">\\n        <div class=\\"shop-cart-empty\\">\\u041f\\u0443\\u0441\\u0442\\u043e<\\/div>\\n    <\\/div>\\n<\\/div>\\n<!--tpl_separator-->\\n<div class=\\"shop-cart\\" data-shopcart=\\"2\\">\\n    <div class=\\"shop-cart-head\\"><a name=\\"shopCart\\"><\\/a><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"full\\">\\n        <form action=\\"[[+this_page_url]]#shopCart\\" method=\\"post\\">\\n        <fieldset>\\n            <div  style=\\"text-align:right;\\">\\n                <a href=\\"[[+empty_url]]\\" id=\\"shk_butEmptyCart\\">\\u041e\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044c \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0443<\\/a>\\n            <\\/div>\\n            <table width=\\"100%\\">\\n                <colgroup>\\n                    <col width=\\"40%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"10%\\" \\/>\\n                <\\/colgroup>\\n                <tbody>\\n                    [[+inner]]\\n                <\\/tbody>\\n            <\\/table>\\n            <div  style=\\"text-align:right;\\">\\n                \\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430: [[+delivery_name]] ([[+delivery_price]] [[+currency]])\\n            <\\/div>\\n            <div  style=\\"text-align:right;\\">\\n                \\u041e\\u0431\\u0449\\u0430\\u044f \\u0441\\u0443\\u043c\\u043c\\u0430: <b>[[+price_total]]<\\/b> [[+currency]]\\n            <\\/div>\\n            <noscript>\\n                <div><input type=\\"submit\\" name=\\"shk_recount\\" value=\\"\\u041f\\u0435\\u0440\\u0435\\u0441\\u0447\\u0438\\u0442\\u0430\\u0442\\u044c\\" \\/><\\/div>\\n            <\\/noscript>\\n            <div class=\\"cart-order\\">\\n                <a href=\\"[[+order_page_url]]\\" id=\\"shk_butOrder\\">\\u041e\\u0444\\u043e\\u0440\\u043c\\u0438\\u0442\\u044c \\u0437\\u0430\\u043a\\u0430\\u0437<\\/a>\\n            <\\/div>\\n        <\\/fieldset>\\n        <\\/form>\\n    <\\/div>\\n<\\/div>","locked":0,"properties":null,"static":0,"static_file":"","content":"<div class=\\"shop-cart\\" data-shopcart=\\"2\\">\\n    <div class=\\"shop-cart-head\\"><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"empty\\">\\n        <div class=\\"shop-cart-empty\\">\\u041f\\u0443\\u0441\\u0442\\u043e<\\/div>\\n    <\\/div>\\n<\\/div>\\n<!--tpl_separator-->\\n<div class=\\"shop-cart\\" data-shopcart=\\"2\\">\\n    <div class=\\"shop-cart-head\\"><a name=\\"shopCart\\"><\\/a><b>\\u041a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0430<\\/b><\\/div>\\n    <div class=\\"full\\">\\n        <form action=\\"[[+this_page_url]]#shopCart\\" method=\\"post\\">\\n        <fieldset>\\n            <div  style=\\"text-align:right;\\">\\n                <a href=\\"[[+empty_url]]\\" id=\\"shk_butEmptyCart\\">\\u041e\\u0447\\u0438\\u0441\\u0442\\u0438\\u0442\\u044c \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0443<\\/a>\\n            <\\/div>\\n            <table width=\\"100%\\">\\n                <colgroup>\\n                    <col width=\\"40%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"25%\\" \\/>\\n                    <col width=\\"10%\\" \\/>\\n                <\\/colgroup>\\n                <tbody>\\n                    [[+inner]]\\n                <\\/tbody>\\n            <\\/table>\\n            <div  style=\\"text-align:right;\\">\\n                \\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430: [[+delivery_name]] ([[+delivery_price]] [[+currency]])\\n            <\\/div>\\n            <div  style=\\"text-align:right;\\">\\n                \\u041e\\u0431\\u0449\\u0430\\u044f \\u0441\\u0443\\u043c\\u043c\\u0430: <b>[[+price_total]]<\\/b> [[+currency]]\\n            <\\/div>\\n            <noscript>\\n                <div><input type=\\"submit\\" name=\\"shk_recount\\" value=\\"\\u041f\\u0435\\u0440\\u0435\\u0441\\u0447\\u0438\\u0442\\u0430\\u0442\\u044c\\" \\/><\\/div>\\n            <\\/noscript>\\n            <div class=\\"cart-order\\">\\n                <a href=\\"[[+order_page_url]]\\" id=\\"shk_butOrder\\">\\u041e\\u0444\\u043e\\u0440\\u043c\\u0438\\u0442\\u044c \\u0437\\u0430\\u043a\\u0430\\u0437<\\/a>\\n            <\\/div>\\n        <\\/fieldset>\\n        <\\/form>\\n    <\\/div>\\n<\\/div>"}',
        'guid' => 'fb2bacec19d1703845bd98b840aaf2cd',
        'native_key' => NULL,
        'signature' => '048790216e65d2d8b8a5062d33fc591c',
      ),
      '9a17e69c7dd388cbff42d80b3e6b8de2' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopOrderForm","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"[[!shkOptions?\\n&get=`delivery,payments`\\n&post_name=`shk_delivery,payment`\\n&toPlaceholders=`1`\\n&pl_prefix=`shkopt_`\\n&tpl=`select_option`\\n]]\\n\\n<p class=\\"error\\">[[!+fi.error.error_message]]<\\/p>\\n<br \\/>\\n\\n<form method=\\"post\\" action=\\"[[~[[*id]]]]\\" id=\\"shopOrderForm\\">\\n\\n<fieldset>\\n\\n<input type=\\"text\\" name=\\"nospam:blank\\" value=\\"\\" style=\\"display:none;\\" \\/>\\n<input type=\\"hidden\\" name=\\"order\\" value=\\"1\\" \\/>\\n\\n<table cellpadding=\\"3\\">\\n    <tr>\\n        <td>\\u0424.\\u0418.\\u041e.*:<\\/td>\\n        <td>\\n            <input name=\\"fullname\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.fullname]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0410\\u0434\\u0440\\u0435\\u0441*:<\\/td>\\n        <td>\\n              <input name=\\"address\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]\\" \\/>\\n              <div>[[!+fi.error.address]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>E-mail*:<\\/td>\\n        <td>\\n            <input name=\\"email\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.email]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d*:<\\/td>\\n        <td>\\n            <input name=\\"phone\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.phone]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438*:<\\/td>\\n        <td>\\n            <select name=\\"shk_delivery\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_delivery]]\\n            <\\/select>\\n            <div>[[!+fi.error.shk_delivery]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b*:<\\/td>\\n        <td>\\n            <select name=\\"payment\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_payments]]\\n            <\\/select>\\n            <div>[[!+fi.error.payment]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n        <td>\\n            <textarea name=\\"message\\" class=\\"textfield\\" rows=\\"4\\" cols=\\"30\\">[[!+fi.message]]<\\/textarea>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td><\\/td>\\n        <td><input type=\\"submit\\" name=\\"submit_button\\" class=\\"button\\" value=\\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u0438\\u0442\\u044c\\" \\/><\\/td>\\n    <\\/tr>\\n<\\/table>\\n\\n<\\/fieldset>\\n\\n<\\/form>","locked":0,"properties":null,"static":0,"static_file":"","content":"[[!shkOptions?\\n&get=`delivery,payments`\\n&post_name=`shk_delivery,payment`\\n&toPlaceholders=`1`\\n&pl_prefix=`shkopt_`\\n&tpl=`select_option`\\n]]\\n\\n<p class=\\"error\\">[[!+fi.error.error_message]]<\\/p>\\n<br \\/>\\n\\n<form method=\\"post\\" action=\\"[[~[[*id]]]]\\" id=\\"shopOrderForm\\">\\n\\n<fieldset>\\n\\n<input type=\\"text\\" name=\\"nospam:blank\\" value=\\"\\" style=\\"display:none;\\" \\/>\\n<input type=\\"hidden\\" name=\\"order\\" value=\\"1\\" \\/>\\n\\n<table cellpadding=\\"3\\">\\n    <tr>\\n        <td>\\u0424.\\u0418.\\u041e.*:<\\/td>\\n        <td>\\n            <input name=\\"fullname\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.fullname:default=`[[+modx.user.id:userinfo=`fullname`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.fullname]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0410\\u0434\\u0440\\u0435\\u0441*:<\\/td>\\n        <td>\\n              <input name=\\"address\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.address:default=`[[+modx.user.id:userinfo=`address`]]`:ne=`0`:show]]\\" \\/>\\n              <div>[[!+fi.error.address]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>E-mail*:<\\/td>\\n        <td>\\n            <input name=\\"email\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.email:default=`[[+modx.user.id:userinfo=`email`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.email]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0422\\u0435\\u043b\\u0435\\u0444\\u043e\\u043d*:<\\/td>\\n        <td>\\n            <input name=\\"phone\\" size=\\"30\\" class=\\"textfield\\" type=\\"text\\" value=\\"[[!+fi.phone:default=`[[+modx.user.id:userinfo=`phone`]]`:ne=`0`:show]]\\" \\/>\\n            <div>[[!+fi.error.phone]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u0434\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0438*:<\\/td>\\n        <td>\\n            <select name=\\"shk_delivery\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_delivery]]\\n            <\\/select>\\n            <div>[[!+fi.error.shk_delivery]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u0421\\u043f\\u043e\\u0441\\u043e\\u0431 \\u043e\\u043f\\u043b\\u0430\\u0442\\u044b*:<\\/td>\\n        <td>\\n            <select name=\\"payment\\" style=\\"width:200px;\\">\\n                <option value=\\"\\"><\\/option>\\n                [[!+shkopt_payments]]\\n            <\\/select>\\n            <div>[[!+fi.error.payment]]<\\/div>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td>\\u041a\\u043e\\u043c\\u043c\\u0435\\u043d\\u0442\\u0430\\u0440\\u0438\\u0439:<\\/td>\\n        <td>\\n            <textarea name=\\"message\\" class=\\"textfield\\" rows=\\"4\\" cols=\\"30\\">[[!+fi.message]]<\\/textarea>\\n        <\\/td>\\n    <\\/tr>\\n    <tr>\\n        <td><\\/td>\\n        <td><input type=\\"submit\\" name=\\"submit_button\\" class=\\"button\\" value=\\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u0438\\u0442\\u044c\\" \\/><\\/td>\\n    <\\/tr>\\n<\\/table>\\n\\n<\\/fieldset>\\n\\n<\\/form>"}',
        'guid' => '17c23c660dc054d210da742098a695c4',
        'native_key' => NULL,
        'signature' => 'cb36677df159f86a65e58bc0fff8959d',
      ),
      '04c97ec9e5b7f25814db3f85dc73eae1' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shopOrderReport","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n\\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0412 \\u0438\\u043d\\u0442\\u0435\\u0440\\u043d\\u0435\\u0442-\\u043c\\u0430\\u0433\\u0430\\u0437\\u0438\\u043d\\u0435 \\u0441\\u0434\\u0435\\u043b\\u0430\\u043d \\u0437\\u0430\\u043a\\u0430\\u0437.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    [[+orderOutputData]]\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>","locked":0,"properties":null,"static":0,"static_file":"","content":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n\\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0412 \\u0438\\u043d\\u0442\\u0435\\u0440\\u043d\\u0435\\u0442-\\u043c\\u0430\\u0433\\u0430\\u0437\\u0438\\u043d\\u0435 \\u0441\\u0434\\u0435\\u043b\\u0430\\u043d \\u0437\\u0430\\u043a\\u0430\\u0437.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    [[+orderOutputData]]\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>"}',
        'guid' => '3db0729d8fe6cc121d597150afeefa31',
        'native_key' => NULL,
        'signature' => '6499359d6b5b78b912eb93e1581d3f76',
      ),
      'b4aa4628fd1e26f354d3b528b07435ff' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"orderDataOuter","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<p><b>\\u0421\\u043e\\u0441\\u0442\\u0430\\u0432 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430<\\/b><\\/p>\\n\\n<table>\\n    <thead>\\n        <tr class=\\"active\\">\\n            <th>\\u041d\\u0430\\u0438\\u043c\\u0435\\u043d\\u043e\\u0432\\u0430\\u043d\\u0438\\u0435<\\/th>\\n            <th>\\u041f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b<\\/th>\\n            <th>\\u041a\\u043e\\u043b-\\u0432\\u043e, \\u0448\\u0442.<\\/th>\\n            <th>\\u0426\\u0435\\u043d\\u0430, [[+currency]]<\\/th>\\n        <\\/tr>\\n    <\\/thead>\\n    <tbody>\\n        [[+purchases]]\\n    <\\/tbody>\\n    <tfoot>\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                [[+delivery]]\\n            <\\/td>\\n            <td>\\n                <b>[[+delivery_price:num_format]]<\\/b>\\n            <\\/td>\\n        <\\/tr>\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                <b>\\u0418\\u0442\\u043e\\u0433\\u043e:<\\/b>\\n            <\\/td>\\n            <td>\\n                <b>[[+price:num_format]]<\\/b>\\n            <\\/td>\\n        <\\/tr>\\n    <\\/tfoot>\\n<\\/table>\\n\\n<p><b>\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435<\\/b><\\/p>\\n\\n<table>\\n    <colgroup>\\n        <col width=\\"50%\\" span=\\"2\\">\\n    <\\/colgroup>\\n    <tbody>\\n        [[+contacts]]\\n    <\\/tbody>\\n<\\/table>","locked":0,"properties":null,"static":0,"static_file":"","content":"<p><b>\\u0421\\u043e\\u0441\\u0442\\u0430\\u0432 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430<\\/b><\\/p>\\n\\n<table>\\n    <thead>\\n        <tr class=\\"active\\">\\n            <th>\\u041d\\u0430\\u0438\\u043c\\u0435\\u043d\\u043e\\u0432\\u0430\\u043d\\u0438\\u0435<\\/th>\\n            <th>\\u041f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b<\\/th>\\n            <th>\\u041a\\u043e\\u043b-\\u0432\\u043e, \\u0448\\u0442.<\\/th>\\n            <th>\\u0426\\u0435\\u043d\\u0430, [[+currency]]<\\/th>\\n        <\\/tr>\\n    <\\/thead>\\n    <tbody>\\n        [[+purchases]]\\n    <\\/tbody>\\n    <tfoot>\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                [[+delivery]]\\n            <\\/td>\\n            <td>\\n                <b>[[+delivery_price:num_format]]<\\/b>\\n            <\\/td>\\n        <\\/tr>\\n        <tr class=\\"cart-order\\">\\n            <td colspan=\\"3\\" style=\\"text-align: right;\\">\\n                <b>\\u0418\\u0442\\u043e\\u0433\\u043e:<\\/b>\\n            <\\/td>\\n            <td>\\n                <b>[[+price:num_format]]<\\/b>\\n            <\\/td>\\n        <\\/tr>\\n    <\\/tfoot>\\n<\\/table>\\n\\n<p><b>\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435<\\/b><\\/p>\\n\\n<table>\\n    <colgroup>\\n        <col width=\\"50%\\" span=\\"2\\">\\n    <\\/colgroup>\\n    <tbody>\\n        [[+contacts]]\\n    <\\/tbody>\\n<\\/table>"}',
        'guid' => '677d3a55cf24484eb1a0c5d57ab15fd5',
        'native_key' => NULL,
        'signature' => 'c5d03cfdbca02865f129fab76ee721ff',
      ),
      '49aff78f25e676c386c2504c1d7d5d9b' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"orderDataRow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<tr class=\\"cart-order\\">\\n    <td>\\n        <b>[[+name]]<\\/b>\\n    <\\/td>\\n    <td>\\n        [[+addit_data:default=`&mdash;`]]\\n    <\\/td>\\n    <td>\\n        [[+count]] \\u0448\\u0442.\\n    <\\/td>\\n    <td>\\n        [[+price]] [[+currency]]\\n    <\\/td>\\n<\\/tr>","locked":0,"properties":null,"static":0,"static_file":"","content":"<tr class=\\"cart-order\\">\\n    <td>\\n        <b>[[+name]]<\\/b>\\n    <\\/td>\\n    <td>\\n        [[+addit_data:default=`&mdash;`]]\\n    <\\/td>\\n    <td>\\n        [[+count]] \\u0448\\u0442.\\n    <\\/td>\\n    <td>\\n        [[+price]] [[+currency]]\\n    <\\/td>\\n<\\/tr>"}',
        'guid' => '5205ff58e58ac42be8c45ebfb5a7e0f9',
        'native_key' => NULL,
        'signature' => '7137c137cba2a6c59346a6012e980552',
      ),
      '08bbd17efe15a511927b67d1d979acf1' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"mailContactsRow","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<tr>\\n    <td>[[+label]]:<\\/td>\\n    <td>[[+value]]<\\/td>\\n<\\/tr>","locked":0,"properties":null,"static":0,"static_file":"","content":"<tr>\\n    <td>[[+label]]:<\\/td>\\n    <td>[[+value]]<\\/td>\\n<\\/tr>"}',
        'guid' => 'ec8c3b8b08bbf1fb9573f3989f5a19a8',
        'native_key' => NULL,
        'signature' => 'b63ccb622e0ddb15b2cbeaa7cd8a6e87',
      ),
      '2704fa08b02e4f30e1f8f16227c0632f' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"select_option","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<option value=\\"[[+value]]\\" [[+selected]]>[[+label]]<\\/option>","locked":0,"properties":null,"static":0,"static_file":"","content":"<option value=\\"[[+value]]\\" [[+selected]]>[[+label]]<\\/option>"}',
        'guid' => 'ebc2525fed9033c1e99c038aae649666',
        'native_key' => NULL,
        'signature' => 'bd87bf67072922abc0f1cf773f1cf91b',
      ),
      '8c9be1dd096887ed367d69d15d786c09' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modChunk',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"userMail","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n\\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0418\\u0437\\u043c\\u0435\\u043d\\u0435\\u043d \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    <p>\\u0412\\u0430\\u0448 \\u0437\\u0430\\u043a\\u0430\\u0437 \\u043f\\u0435\\u0440\\u0435\\u0432\\u0435\\u0434\\u0435\\u043d \\u0432 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441: <b>[[+statusName]]<\\/b>.<\\/p>\\n    \\n    [[+orderOutputData]]\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>","locked":0,"properties":null,"static":0,"static_file":"","content":"<!DOCTYPE html>\\n<html>\\n\\n<head>\\n<style type=\\"text\\/css\\">\\nbody{background-color:#fff;}\\ntable {width:650px; margin:10px 0; border:1px solid #BCBCBC; border-collapse:collapse;}\\ntable td {padding:5px; border:1px solid #BCBCBC;}\\n<\\/style>\\n<\\/head>\\n\\n<body>\\n\\n<p><b>[[++site_name]]<\\/b><\\/p>\\n\\n<p>\\u0418\\u0437\\u043c\\u0435\\u043d\\u0435\\u043d \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430.<\\/p>\\n\\n<div style=\\"padding:15px 0; margin:15px 0; border-top:3px solid #BCBCBC; border-bottom:3px solid #BCBCBC;\\">\\n\\n    <p>\\u041d\\u043e\\u043c\\u0435\\u0440 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430: [[+orderID]]<\\/p>\\n    \\n    <p>\\u0414\\u0430\\u0442\\u0430: [[+orderDate]].<\\/p>\\n    \\n    <p>\\u0412\\u0430\\u0448 \\u0437\\u0430\\u043a\\u0430\\u0437 \\u043f\\u0435\\u0440\\u0435\\u0432\\u0435\\u0434\\u0435\\u043d \\u0432 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441: <b>[[+statusName]]<\\/b>.<\\/p>\\n    \\n    [[+orderOutputData]]\\n\\n<\\/div>\\n\\n<a href=\\"[[++site_url]]\\" target=\\"_blank\\">[[++site_url]]<\\/a>\\n\\n<br \\/><br \\/>\\n\\n<\\/body>\\n<\\/html>"}',
        'guid' => 'a3234cf1755279c20e1dd2bd975e2fc1',
        'native_key' => NULL,
        'signature' => '48a1d0d7d563663a1e49169c05990f60',
      ),
    ),
    'Snippets' => 
    array (
      '301f11bd7e1eae83ca61c770acaf4627' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"Shopkeeper3","description":"Shopping cart","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * Shopkeeper\\n * \\n * Shopping cart for MODx Revolution\\n *\\n * @package shopkeeper3\\n * @category \\t   snippet\\n * @version \\t   3.x\\n * @license \\t   http:\\/\\/www.gnu.org\\/copyleft\\/gpl.html GNU Public License (GPL)\\n * @internal\\t   @properties\\n * @internal\\t   @modx_category Shop\\n *\\/\\n\\nif(isset($hideOn) && preg_match(\'\\/(^|\\\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)\\/\',$hideOn)) return \'\';\\n\\n$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;\\n$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];\\nif( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . \\"components\\/shopkeeper3\\/\\" );\\n\\n$output = \'\';\\n\\nrequire_once $modx->getOption(\'core_path\') . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n\\n$shopCart = new Shopkeeper($modx, $scriptProperties, true);\\n$noJavaScript = $modx->getOption( \'noJavaScript\', $scriptProperties, false );\\n$optStyles = $modx->getOption(\'style\', $scriptProperties, 1);\\n$optJsScripts = $modx->getOption(\'jsScript\', $scriptProperties, 1);\\n\\nif( $SHK_callCount === 1 ){\\n    \\n    if( $optStyles ){\\n        $modx->regClientCSS( SHOPKEEPER_URL . \\"web\\/css\\/\\".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . \\"\\/style.css\\" );\\n    }\\n\\n    if( !$modx->getOption(\'noJQuery\', $scriptProperties, false) ){\\n        $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/jquery-1.11.1.min.js\\");\\n    }\\n\\n    if( $optJsScripts ) {\\n\\n        if( $optJsScripts != 2 ) {\\n\\n            $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/lang\\/\\" . $modx->getOption(\'lang\', $scriptProperties, \'ru\') . \\".js?v=\\" . $shopCart->getVersion());\\n            $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/shopkeeper.js?v=\\" . $shopCart->getVersion());\\n\\n        }\\n\\n        $shk_opts = array(\\n            \'prodCont\' => $modx->getOption(\'prodCont\', $scriptProperties, \'div.shk-item\'),\\n            \'site_base_url\' => $modx->config[\'base_url\'],\\n            \'counterField\' => $modx->getOption(\'counterField\', $scriptProperties, false),\\n            \'counterFieldCart\' => $modx->getOption(\'counterFieldCart\', $scriptProperties, true),\\n            \'changePrice\' => $modx->getOption(\'changePrice\', $scriptProperties, true),\\n            \'flyToCart\' => $modx->getOption(\'flyToCart\', $scriptProperties, \'helper\'),\\n            \'noLoader\' => $modx->getOption(\'noLoader\', $scriptProperties, false),\\n            \'allowFloatCount\' => $modx->getOption(\'allowFloatCount\', $scriptProperties, false),\\n            \'animCart\' => $modx->getOption(\'animCart\', $scriptProperties, true),\\n            \'goToOrderFormPage\' => $modx->getOption(\'goToOrderFormPage\', $scriptProperties, false),\\n            \\/\\/\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),\\n            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\', $scriptProperties, 1), \'\', \'\', \'abs\'),\\n            \'debug\' => $modx->getOption(\'debug\', $scriptProperties, false)\\n        );\\n\\n        $delivery_price = !empty($shopCart->delivery[\'price\']) ? number_format($shopCart->delivery[\'price\'], 2, \'.\', \'\') : 0;\\n        $delivery_name = !empty($shopCart->delivery[\'label\']) ? $shopCart->delivery[\'label\'] : \'\';\\n\\n        $shk_data = array(\\n            \'price_total\' => number_format(Shopkeeper::$price_total, 2, \'.\', \'\'),\\n            \'items_total\' => Shopkeeper::$items_total,\\n            \'items_unique_total\' => Shopkeeper::$items_unique_total,\\n            \'delivery_price\' => $delivery_price,\\n            \'delivery_name\' => $delivery_name,\\n            \'ids\' => $shopCart->getProdIds()\\n        );\\n\\n        $shk_data_str = json_encode($shk_data);\\n        $options_obj_str = json_encode($shk_opts);\\n\\n        \\/\\/create script\\n        $headHtml = \\"\\\\t<script type=\\\\\\"text\\/javascript\\\\\\">\\";\\n        $headHtml .= \\"\\n        SHK.data = \\" . $shk_data_str . \\";\\n        jQuery(document).bind( \'ready\', function(){\\n            SHK.init( \\" . $options_obj_str . \\" );\\n        });\\" . PHP_EOL;\\n\\n        $headHtml .= \\"\\\\t<\\/script>\\" . PHP_EOL;\\n\\n        $modx->regClientScript($headHtml);\\n\\n    }\\n    \\n}\\n\\n\\/\\/\\u0432\\u044b\\u0432\\u043e\\u0434 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u044b\\n$output .= $shopCart->getCartContent();\\n\\nreturn $output;","locked":0,"properties":"a:35:{s:4:\\"lang\\";a:7:{s:4:\\"name\\";s:4:\\"lang\\";s:4:\\"desc\\";s:13:\\"prop_shk.lang\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:2:\\"ru\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"prodCont\\";a:7:{s:4:\\"name\\";s:8:\\"prodCont\\";s:4:\\"desc\\";s:17:\\"prop_shk.prodcont\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:12:\\"div.shk-item\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"tplPath\\";a:7:{s:4:\\"name\\";s:7:\\"tplPath\\";s:4:\\"desc\\";s:16:\\"prop_shk.tplpath\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:47:\\"core\\/components\\/shopkeeper3\\/elements\\/chunks\\/ru\\/\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"cartTpl\\";a:7:{s:4:\\"name\\";s:7:\\"cartTpl\\";s:4:\\"desc\\";s:16:\\"prop_shk.carttpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:18:\\"@FILE shopCart.tpl\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"cartRowTpl\\";a:7:{s:4:\\"name\\";s:10:\\"cartRowTpl\\";s:4:\\"desc\\";s:19:\\"prop_shk.cartrowtpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:21:\\"@FILE shopCartRow.tpl\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"orderDataTpl\\";a:7:{s:4:\\"name\\";s:12:\\"orderDataTpl\\";s:4:\\"desc\\";s:21:\\"prop_shk.orderdatatpl\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:19:\\"@FILE orderData.tpl\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"flyToCart\\";a:7:{s:4:\\"name\\";s:9:\\"flyToCart\\";s:4:\\"desc\\";s:18:\\"prop_shk.flytocart\\";s:4:\\"type\\";s:4:\\"list\\";s:7:\\"options\\";a:4:{i:0;a:2:{s:4:\\"text\\";s:6:\\"helper\\";s:5:\\"value\\";s:6:\\"helper\\";}i:1;a:2:{s:4:\\"text\\";s:5:\\"image\\";s:5:\\"value\\";s:5:\\"image\\";}i:2;a:2:{s:4:\\"text\\";s:11:\\"scrollimage\\";s:5:\\"value\\";s:11:\\"scrollimage\\";}i:3;a:2:{s:4:\\"text\\";s:5:\\"nofly\\";s:5:\\"value\\";s:5:\\"nofly\\";}}s:5:\\"value\\";s:6:\\"helper\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"fieldPrice\\";a:7:{s:4:\\"name\\";s:10:\\"fieldPrice\\";s:4:\\"desc\\";s:16:\\"prop_shk.pricetv\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:5:\\"price\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"style\\";a:7:{s:4:\\"name\\";s:5:\\"style\\";s:4:\\"desc\\";s:14:\\"prop_shk.style\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"default\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"currency\\";a:7:{s:4:\\"name\\";s:8:\\"currency\\";s:4:\\"desc\\";s:17:\\"prop_shk.currency\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"\\u0440\\u0443\\u0431.\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"noCounter\\";a:7:{s:4:\\"name\\";s:9:\\"noCounter\\";s:4:\\"desc\\";s:18:\\"prop_shk.nocounter\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"noLoader\\";a:7:{s:4:\\"name\\";s:8:\\"noLoader\\";s:4:\\"desc\\";s:17:\\"prop_shk.noloader\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"orderFormPageId\\";a:7:{s:4:\\"name\\";s:15:\\"orderFormPageId\\";s:4:\\"desc\\";s:22:\\"prop_shk.orderformpage\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:17:\\"goToOrderFormPage\\";a:7:{s:4:\\"name\\";s:17:\\"goToOrderFormPage\\";s:4:\\"desc\\";s:26:\\"prop_shk.gotoorderformpage\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:12:\\"counterField\\";a:7:{s:4:\\"name\\";s:12:\\"counterField\\";s:4:\\"desc\\";s:21:\\"prop_shk.counterfield\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"counterFieldCart\\";a:7:{s:4:\\"name\\";s:16:\\"counterFieldCart\\";s:4:\\"desc\\";s:25:\\"prop_shk.counterFieldCart\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"excepDigitGroup\\";a:7:{s:4:\\"name\\";s:15:\\"excepDigitGroup\\";s:4:\\"desc\\";s:24:\\"prop_shk.excepdigitgroup\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"changePrice\\";a:7:{s:4:\\"name\\";s:11:\\"changePrice\\";s:4:\\"desc\\";s:20:\\"prop_shk.changeprice\\";s:4:\\"type\\";s:4:\\"list\\";s:7:\\"options\\";a:3:{i:0;a:2:{s:4:\\"text\\";s:3:\\"yes\\";s:5:\\"value\\";s:1:\\"1\\";}i:1;a:2:{s:4:\\"text\\";s:2:\\"no\\";s:5:\\"value\\";s:1:\\"0\\";}i:2;a:2:{s:4:\\"text\\";s:7:\\"replace\\";s:5:\\"value\\";s:7:\\"replace\\";}}s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"animCart\\";a:7:{s:4:\\"name\\";s:8:\\"animCart\\";s:4:\\"desc\\";s:17:\\"prop_shk.animcart\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:1;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:15:\\"allowFloatCount\\";a:7:{s:4:\\"name\\";s:15:\\"allowFloatCount\\";s:4:\\"desc\\";s:24:\\"prop_shk.allowfloatcount\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"jsScript\\";a:7:{s:4:\\"name\\";s:8:\\"jsScript\\";s:4:\\"desc\\";s:21:\\"prop_shk.nojavascript\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:8:\\"noJQuery\\";a:7:{s:4:\\"name\\";s:8:\\"noJQuery\\";s:4:\\"desc\\";s:17:\\"prop_shk.nojquery\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"noConflict\\";a:7:{s:4:\\"name\\";s:10:\\"noConflict\\";s:4:\\"desc\\";s:19:\\"prop_shk.noconflict\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:6:\\"hideOn\\";a:7:{s:4:\\"name\\";s:6:\\"hideOn\\";s:4:\\"desc\\";s:15:\\"prop_shk.hideon\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:10:\\"TVsaveList\\";a:7:{s:4:\\"name\\";s:10:\\"TVsaveList\\";s:4:\\"desc\\";s:19:\\"prop_shk.TVsaveList\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:14:\\"fromParentList\\";a:7:{s:4:\\"name\\";s:14:\\"fromParentList\\";s:4:\\"desc\\";s:23:\\"prop_shk.fromParentList\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"fromParentHeight\\";a:7:{s:4:\\"name\\";s:16:\\"fromParentHeight\\";s:4:\\"desc\\";s:25:\\"prop_shk.fromParentHeight\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:16:\\"additParamSource\\";a:7:{s:4:\\"name\\";s:16:\\"additParamSource\\";s:4:\\"desc\\";s:25:\\"prop_shk.additParamSource\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:9:\\"className\\";a:7:{s:4:\\"name\\";s:9:\\"className\\";s:4:\\"desc\\";s:18:\\"prop_shk.className\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:11:\\"modResource\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"packageName\\";a:7:{s:4:\\"name\\";s:11:\\"packageName\\";s:4:\\"desc\\";s:20:\\"prop_shk.packageName\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:19:\\"savePurchasesFields\\";a:7:{s:4:\\"name\\";s:19:\\"savePurchasesFields\\";s:4:\\"desc\\";s:28:\\"prop_shk.savePurchasesFields\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:5:\\"debug\\";a:7:{s:4:\\"name\\";s:5:\\"debug\\";s:4:\\"desc\\";s:14:\\"prop_shk.debug\\";s:4:\\"type\\";s:13:\\"combo-boolean\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";b:0;s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:13:\\"processParams\\";a:7:{s:4:\\"name\\";s:13:\\"processParams\\";s:4:\\"desc\\";s:22:\\"prop_shk.processParams\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"0\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:11:\\"pluralWords\\";a:7:{s:4:\\"name\\";s:11:\\"pluralWords\\";s:4:\\"desc\\";s:20:\\"prop_shk.pluralWords\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}s:7:\\"groupBy\\";a:7:{s:4:\\"name\\";s:7:\\"groupBy\\";s:4:\\"desc\\";s:16:\\"prop_shk.groupBy\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";s:22:\\"shopkeeper3:properties\\";s:4:\\"area\\";s:0:\\"\\";}}","moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * Shopkeeper\\n * \\n * Shopping cart for MODx Revolution\\n *\\n * @package shopkeeper3\\n * @category \\t   snippet\\n * @version \\t   3.x\\n * @license \\t   http:\\/\\/www.gnu.org\\/copyleft\\/gpl.html GNU Public License (GPL)\\n * @internal\\t   @properties\\n * @internal\\t   @modx_category Shop\\n *\\/\\n\\nif(isset($hideOn) && preg_match(\'\\/(^|\\\\s|,)\'.$modx->resource->get(\'id\').\'(,|$)\\/\',$hideOn)) return \'\';\\n\\n$modx->placeholders[\'SHK_callCount\'] = isset($modx->placeholders[\'SHK_callCount\']) ? $modx->placeholders[\'SHK_callCount\']+1 : 1;\\n$SHK_callCount = $modx->placeholders[\'SHK_callCount\'];\\nif( !defined( \'SHOPKEEPER_URL\' ) ) define( \'SHOPKEEPER_URL\', $modx->getOption(\'assets_url\') . \\"components\\/shopkeeper3\\/\\" );\\n\\n$output = \'\';\\n\\nrequire_once $modx->getOption(\'core_path\') . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n\\n$shopCart = new Shopkeeper($modx, $scriptProperties, true);\\n$noJavaScript = $modx->getOption( \'noJavaScript\', $scriptProperties, false );\\n$optStyles = $modx->getOption(\'style\', $scriptProperties, 1);\\n$optJsScripts = $modx->getOption(\'jsScript\', $scriptProperties, 1);\\n\\nif( $SHK_callCount === 1 ){\\n    \\n    if( $optStyles ){\\n        $modx->regClientCSS( SHOPKEEPER_URL . \\"web\\/css\\/\\".$modx->getOption( \'style\', $scriptProperties, \'default\' ) . \\"\\/style.css\\" );\\n    }\\n\\n    if( !$modx->getOption(\'noJQuery\', $scriptProperties, false) ){\\n        $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/jquery-1.11.1.min.js\\");\\n    }\\n\\n    if( $optJsScripts ) {\\n\\n        if( $optJsScripts != 2 ) {\\n\\n            $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/lang\\/\\" . $modx->getOption(\'lang\', $scriptProperties, \'ru\') . \\".js?v=\\" . $shopCart->getVersion());\\n            $modx->regClientScript(SHOPKEEPER_URL . \\"web\\/js\\/shopkeeper.js?v=\\" . $shopCart->getVersion());\\n\\n        }\\n\\n        $shk_opts = array(\\n            \'prodCont\' => $modx->getOption(\'prodCont\', $scriptProperties, \'div.shk-item\'),\\n            \'site_base_url\' => $modx->config[\'base_url\'],\\n            \'counterField\' => $modx->getOption(\'counterField\', $scriptProperties, false),\\n            \'counterFieldCart\' => $modx->getOption(\'counterFieldCart\', $scriptProperties, true),\\n            \'changePrice\' => $modx->getOption(\'changePrice\', $scriptProperties, true),\\n            \'flyToCart\' => $modx->getOption(\'flyToCart\', $scriptProperties, \'helper\'),\\n            \'noLoader\' => $modx->getOption(\'noLoader\', $scriptProperties, false),\\n            \'allowFloatCount\' => $modx->getOption(\'allowFloatCount\', $scriptProperties, false),\\n            \'animCart\' => $modx->getOption(\'animCart\', $scriptProperties, true),\\n            \'goToOrderFormPage\' => $modx->getOption(\'goToOrderFormPage\', $scriptProperties, false),\\n            \\/\\/\'orderFormPage\' => $modx->getOption(\'orderFormPage\',$scriptProperties,0),\\n            \'orderFormPageUrl\' => $modx->makeUrl($modx->getOption(\'orderFormPageId\', $scriptProperties, 1), \'\', \'\', \'abs\'),\\n            \'debug\' => $modx->getOption(\'debug\', $scriptProperties, false)\\n        );\\n\\n        $delivery_price = !empty($shopCart->delivery[\'price\']) ? number_format($shopCart->delivery[\'price\'], 2, \'.\', \'\') : 0;\\n        $delivery_name = !empty($shopCart->delivery[\'label\']) ? $shopCart->delivery[\'label\'] : \'\';\\n\\n        $shk_data = array(\\n            \'price_total\' => number_format(Shopkeeper::$price_total, 2, \'.\', \'\'),\\n            \'items_total\' => Shopkeeper::$items_total,\\n            \'items_unique_total\' => Shopkeeper::$items_unique_total,\\n            \'delivery_price\' => $delivery_price,\\n            \'delivery_name\' => $delivery_name,\\n            \'ids\' => $shopCart->getProdIds()\\n        );\\n\\n        $shk_data_str = json_encode($shk_data);\\n        $options_obj_str = json_encode($shk_opts);\\n\\n        \\/\\/create script\\n        $headHtml = \\"\\\\t<script type=\\\\\\"text\\/javascript\\\\\\">\\";\\n        $headHtml .= \\"\\n        SHK.data = \\" . $shk_data_str . \\";\\n        jQuery(document).bind( \'ready\', function(){\\n            SHK.init( \\" . $options_obj_str . \\" );\\n        });\\" . PHP_EOL;\\n\\n        $headHtml .= \\"\\\\t<\\/script>\\" . PHP_EOL;\\n\\n        $modx->regClientScript($headHtml);\\n\\n    }\\n    \\n}\\n\\n\\/\\/\\u0432\\u044b\\u0432\\u043e\\u0434 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u044b\\n$output .= $shopCart->getCartContent();\\n\\nreturn $output;"}',
        'guid' => '743eba68f6f5b58efce485a64195b7c9',
        'native_key' => NULL,
        'signature' => '864ff34b06f970df43adbf90299e31e3',
      ),
      'fc7e83c2632969946b4c3c6b9501b52a' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_fihook","description":"FormIt hook for Shopkeeper","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * FormIt hook for Shopkeeper 3.x\\n *\\/\\n\\n\\/\\/ini_set(\'display_errors\',1);\\n\\/\\/error_reporting(E_ALL);\\n\\n$output = false;\\n\\nif(!defined(\'SHOPKEEPER_PATH\')){\\n    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH.\\"components\\/shopkeeper3\\/\\");\\n}\\n\\n\\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0441\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442\\u0430 Shopkeeper\\n$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );\\n$sys_property_sets = explode( \',\', $sys_property_sets );\\n$propertySetName = trim( current( $sys_property_sets ) );\\n\\n$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));\\n$properties = $snippet->getProperties();\\nif( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){\\n    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );\\n    $propSetProperties = $propSet->getProperties();\\n    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);\\n}\\n\\n$lang = $modx->getOption( \'lang\', $properties, \'ru\' );\\n$modx->getService( \'lexicon\', \'modLexicon\' );\\n$modx->lexicon->load( $lang . \':shopkeeper3:default\' );\\n\\nif( !empty( $_SESSION[\'shk_order\'] ) ){\\n    \\n    require_once SHOPKEEPER_PATH . \\"model\\/shopkeeper.class.php\\";\\n    $shopCart = new Shopkeeper( $modx, $properties );\\n    \\n    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model\\/\' );\\n    \\n    \\/\\/shopkeeper settings\\n    $contacts_fields = array();\\n    $response = $modx->runProcessor(\'getsettings\',\\n        array( \'settings\' => array(\'contacts_fields\') ),\\n        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components\\/shopkeeper3\\/processors\\/mgr\\/\' )\\n    );\\n    if ($response->isError()) {\\n        echo $response->getMessage();\\n    }\\n    if($result = $response->getResponse()){\\n        \\n        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();\\n        if( !empty( $temp_arr ) ){\\n            \\n            foreach( $temp_arr as $opt ){\\n                \\n                $contacts_fields[$opt[\'name\']] = $opt;\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n    $userId = $modx->getLoginUserID( $modx->context->key );\\n    if( !$userId ) $userId = 0;\\n    \\n    \\/\\/\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435\\n    $contacts = array();\\n    $allFormFields = $hook->getValues();\\n    foreach( $allFormFields as $key => $val ){\\n        \\n        if( in_array( $key, array_keys( $contacts_fields ) ) ){\\n            \\n            $temp_arr = array(\\n                \'name\' => $contacts_fields[$key][\'name\'],\\n                \'value\' => $val,\\n                \'label\' => $contacts_fields[$key][\'label\']\\n            );\\n            \\n            array_push( $contacts, $temp_arr );\\n            \\n        }\\n        \\n    }\\n    \\n    $contacts = json_encode( $contacts );\\n    \\n    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );\\n    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );\\n    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );\\n    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );\\n    \\n    \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';\\n    if( !$delivery_name ){\\n\\t$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';\\n    }\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    $order = $modx->newObject(\'shk_order\');\\n    $insert_data = array(\\n        \'contacts\' => $contacts,\\n        \'options\' => \'\',\\n        \'price\' => Shopkeeper::$price_total,\\n        \'currency\' => $shopCart->config[\'currency\'],\\n        \'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n        \'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n        \'note\' => \'\',\\n        \'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',\\n        \'delivery\' => $delivery_name,\\n        \'delivery_price\' => $delivery_price,\\n        \'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',\\n        \'tracking_num\' => \'\',\\n        \'phone\' => isset( $allFormFields[$phoneField] ) ? $allFormFields[$phoneField] : \'\',\\n        \'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )\\n    );\\n    if( $userId ){\\n        $insert_data[\'userid\'] = $userId;\\n    }\\n    $order->fromArray($insert_data);\\n    $saved = $order->save();\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0442\\u043e\\u0432\\u0430\\u0440\\u044b \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    if( $saved ){\\n\\n        $purchasesData = $shopCart->getProductsData( true );\\n\\n        foreach( $shopCart->data as $key => $p_data ){\\n\\n            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';\\n            $fields_data = !empty( $purchasesData[ $key ] ) ? $purchasesData[ $key ] : array();\\n            $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';\\n            unset( $fields_data[\'id\'] );\\n            $fields_data_str = json_encode( $fields_data );\\n\\n            $insert_data = array(\\n                \'p_id\' => $p_data[\'id\'],\\n                \'order_id\' => $order->id,\\n                \'name\' => $p_data[\'name\'],\\n                \'price\' => $p_data[\'price\'],\\n                \'count\' => $p_data[\'count\'],\\n                \'class_name\' => $p_data[\'className\'],\\n                \'package_name\' => $p_data[\'packageName\'],\\n                \'data\' => $fields_data_str,\\n                \'options\' => $options\\n            );\\n\\n            $purchase = $modx->newObject(\'shk_purchases\');\\n            $purchase->fromArray( $insert_data );\\n            $purchase->save();\\n\\n        }\\n\\n        $shopCart->setOrderDataSession( $order->toArray() );\\n\\n    }\\n    \\n    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );\\n    \\n    $orderOutputData = $shopCart->getOrderData( $order->id );\\n    \\n    \\/\\/OnSHKsaveOrder\\n    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));\\n    if(is_array($evtOut)) $orderOutputData .= implode(\'\',$evtOut);\\n    \\n    $hook->setValues(array(\\n        \'orderID\' => $order->get(\'id\'),\\n        \'orderDate\' => $order->get(\'date\'),\\n        \'orderPrice\' => $order->get(\'price\'),\\n        \'orderCurrency\' => $shopCart->config[\'currency\'],\\n        \'orderOutputData\' => $orderOutputData\\n    ));\\n    \\n    $shopCart->request_empty( false );\\n    \\n    $output = true;\\n    \\n}else{\\n    \\n    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );\\n    $output = false;\\n    \\n}\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * FormIt hook for Shopkeeper 3.x\\n *\\/\\n\\n\\/\\/ini_set(\'display_errors\',1);\\n\\/\\/error_reporting(E_ALL);\\n\\n$output = false;\\n\\nif(!defined(\'SHOPKEEPER_PATH\')){\\n    define(\'SHOPKEEPER_PATH\', MODX_CORE_PATH.\\"components\\/shopkeeper3\\/\\");\\n}\\n\\n\\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0441\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442\\u0430 Shopkeeper\\n$sys_property_sets = $modx->getOption( \'shk3.property_sets\', $modx->config, \'default\' );\\n$sys_property_sets = explode( \',\', $sys_property_sets );\\n$propertySetName = trim( current( $sys_property_sets ) );\\n\\n$snippet = $modx->getObject(\'modSnippet\',array(\'name\'=>\'Shopkeeper3\'));\\n$properties = $snippet->getProperties();\\nif( $propertySetName != \'default\' && $modx->getCount( \'modPropertySet\', array( \'name\' => $propertySetName ) ) > 0 ){\\n    $propSet = $modx->getObject( \'modPropertySet\', array( \'name\' => $propertySetName ) );\\n    $propSetProperties = $propSet->getProperties();\\n    if(is_array($propSetProperties)) $properties = array_merge($properties,$propSetProperties);\\n}\\n\\n$lang = $modx->getOption( \'lang\', $properties, \'ru\' );\\n$modx->getService( \'lexicon\', \'modLexicon\' );\\n$modx->lexicon->load( $lang . \':shopkeeper3:default\' );\\n\\nif( !empty( $_SESSION[\'shk_order\'] ) ){\\n    \\n    require_once SHOPKEEPER_PATH . \\"model\\/shopkeeper.class.php\\";\\n    $shopCart = new Shopkeeper( $modx, $properties );\\n    \\n    $modx->addPackage( \'shopkeeper3\', SHOPKEEPER_PATH . \'model\\/\' );\\n    \\n    \\/\\/shopkeeper settings\\n    $contacts_fields = array();\\n    $response = $modx->runProcessor(\'getsettings\',\\n        array( \'settings\' => array(\'contacts_fields\') ),\\n        array( \'processors_path\' => $modx->getOption( \'core_path\' ) . \'components\\/shopkeeper3\\/processors\\/mgr\\/\' )\\n    );\\n    if ($response->isError()) {\\n        echo $response->getMessage();\\n    }\\n    if($result = $response->getResponse()){\\n        \\n        $temp_arr = !empty( $result[\'object\'][\'contacts_fields\'] ) ? $result[\'object\'][\'contacts_fields\'] : array();\\n        if( !empty( $temp_arr ) ){\\n            \\n            foreach( $temp_arr as $opt ){\\n                \\n                $contacts_fields[$opt[\'name\']] = $opt;\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n    $userId = $modx->getLoginUserID( $modx->context->key );\\n    if( !$userId ) $userId = 0;\\n    \\n    \\/\\/\\u041a\\u043e\\u043d\\u0442\\u0430\\u043a\\u0442\\u043d\\u044b\\u0435 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435\\n    $contacts = array();\\n    $allFormFields = $hook->getValues();\\n    foreach( $allFormFields as $key => $val ){\\n        \\n        if( in_array( $key, array_keys( $contacts_fields ) ) ){\\n            \\n            $temp_arr = array(\\n                \'name\' => $contacts_fields[$key][\'name\'],\\n                \'value\' => $val,\\n                \'label\' => $contacts_fields[$key][\'label\']\\n            );\\n            \\n            array_push( $contacts, $temp_arr );\\n            \\n        }\\n        \\n    }\\n    \\n    $contacts = json_encode( $contacts );\\n    \\n    $emailField = $modx->getOption( \'fiarToField\', $hook->config, \'email\' );\\n    $phoneField = $modx->getOption( \'phoneField\', $hook->config, \'phone\' );\\n    $deliveryField = $modx->getOption( \'deliveryField\', $hook->config, \'shk_delivery\' );\\n    $paymentField = $modx->getOption( \'paymentField\', $hook->config, \'payment\' );\\n    \\n    \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n    $delivery_price = !empty( $shopCart->delivery[\'price\'] ) ? $shopCart->delivery[\'price\'] : 0;\\n    $delivery_name = !empty( $shopCart->delivery[\'label\'] ) ? $shopCart->delivery[\'label\'] : \'\';\\n    if( !$delivery_name ){\\n\\t$delivery_name = !empty( $allFormFields[$deliveryField] ) ? $allFormFields[$deliveryField] : \'\';\\n    }\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    $order = $modx->newObject(\'shk_order\');\\n    $insert_data = array(\\n        \'contacts\' => $contacts,\\n        \'options\' => \'\',\\n        \'price\' => Shopkeeper::$price_total,\\n        \'currency\' => $shopCart->config[\'currency\'],\\n        \'date\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n        \'sentdate\' => strftime(\'%Y-%m-%d %H:%M:%S\'),\\n        \'note\' => \'\',\\n        \'email\' => isset( $allFormFields[$emailField] ) ? $allFormFields[$emailField] : \'\',\\n        \'delivery\' => $delivery_name,\\n        \'delivery_price\' => $delivery_price,\\n        \'payment\' => isset( $allFormFields[$paymentField] ) ? $allFormFields[$paymentField] : \'\',\\n        \'tracking_num\' => \'\',\\n        \'phone\' => isset( $allFormFields[$phoneField] ) ? $allFormFields[$phoneField] : \'\',\\n        \'status\' => $modx->getOption( \'shk3.first_status\', null, \'1\' )\\n    );\\n    if( $userId ){\\n        $insert_data[\'userid\'] = $userId;\\n    }\\n    $order->fromArray($insert_data);\\n    $saved = $order->save();\\n    \\n    \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u0442\\u043e\\u0432\\u0430\\u0440\\u044b \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430\\n    if( $saved ){\\n\\n        $purchasesData = $shopCart->getProductsData( true );\\n\\n        foreach( $shopCart->data as $key => $p_data ){\\n\\n            $options = !empty( $p_data[\'options\'] ) ? json_encode( $p_data[\'options\'] ) : \'\';\\n            $fields_data = !empty( $purchasesData[ $key ] ) ? $purchasesData[ $key ] : array();\\n            $fields_data[\'url\'] = !empty( $p_data[\'url\'] ) ? $p_data[\'url\'] : \'\';\\n            unset( $fields_data[\'id\'] );\\n            $fields_data_str = json_encode( $fields_data );\\n\\n            $insert_data = array(\\n                \'p_id\' => $p_data[\'id\'],\\n                \'order_id\' => $order->id,\\n                \'name\' => $p_data[\'name\'],\\n                \'price\' => $p_data[\'price\'],\\n                \'count\' => $p_data[\'count\'],\\n                \'class_name\' => $p_data[\'className\'],\\n                \'package_name\' => $p_data[\'packageName\'],\\n                \'data\' => $fields_data_str,\\n                \'options\' => $options\\n            );\\n\\n            $purchase = $modx->newObject(\'shk_purchases\');\\n            $purchase->fromArray( $insert_data );\\n            $purchase->save();\\n\\n        }\\n\\n        $shopCart->setOrderDataSession( $order->toArray() );\\n\\n    }\\n    \\n    $modx->invokeEvent( \'OnSHKChangeStatus\', array( \'order_ids\' => array( $order->id ), \'status\' => $order->status ) );\\n    \\n    $orderOutputData = $shopCart->getOrderData( $order->id );\\n    \\n    \\/\\/OnSHKsaveOrder\\n    $evtOut = $modx->invokeEvent(\'OnSHKsaveOrder\',array(\'order_id\' => $order->get(\'id\')));\\n    if(is_array($evtOut)) $orderOutputData .= implode(\'\',$evtOut);\\n    \\n    $hook->setValues(array(\\n        \'orderID\' => $order->get(\'id\'),\\n        \'orderDate\' => $order->get(\'date\'),\\n        \'orderPrice\' => $order->get(\'price\'),\\n        \'orderCurrency\' => $shopCart->config[\'currency\'],\\n        \'orderOutputData\' => $orderOutputData\\n    ));\\n    \\n    $shopCart->request_empty( false );\\n    \\n    $output = true;\\n    \\n}else{\\n    \\n    $hook->addError( \'error_message\', $modx->lexicon(\'shk.order_empty\') );\\n    $output = false;\\n    \\n}\\n\\nreturn $output;"}',
        'guid' => '314a0f8a39854047a697c951decd75f2',
        'native_key' => NULL,
        'signature' => 'efbad59df93375e9a74b4d0f31a0719a',
      ),
      'c8ef99d8e242389a38eb6ac665f5bf82' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shkOptions","description":"Print configuration of Shopkeeper","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * shkOptions\\n * \\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u0442 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0438\\u0437 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u0438 Shopkeeper\\n *\\n *\\/\\n\\n$output = array();\\n\\n$get = $modx->getOption( \'get\', $scriptProperties, \'\' );\\n$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );\\n$get = explode( \',\', $get );\\n$get = array_map( \'trim\', $get );\\n$post_name = array_map( \'trim\', $post_name );\\n$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );\\n$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );\\n$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );\\n\\nif( empty( $get ) ) return \'\';\\n\\nif( class_exists(\'Shopkeeper\') ){\\n    \\n    $config = Shopkeeper::getConfig( $get );\\n    \\n    \\/\\/echo \'<pre>\' . print_r( $config, true ) . \'<\\/pre>\';\\n    \\n    if( !empty( $config ) ){\\n        \\n        foreach( $get as $index => $opt_name ){\\n            \\n            if( !empty( $config[ $opt_name ] ) ){\\n                \\n                $output[ $opt_name ] = \'\';\\n                \\n                foreach( $config[ $opt_name ] as $key => $conf ){\\n                    \\n                    if( empty( $conf[\'value\'] ) ){\\n                        $conf[\'value\'] = $conf[\'label\'];\\n                    }\\n                    \\n                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected=\\"selected\\"\' : \'\' );\\n                    \\n                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . \\"\\\\t\\";\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\nif( $toPlaceholders ){\\n    \\n    foreach( $output as $pl_name => $out ){\\n        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );\\n    }\\n    \\n    $output = array();\\n    \\n}\\n\\nreturn implode( \'\', $output );","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * shkOptions\\n * \\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u0442 \\u0434\\u0430\\u043d\\u043d\\u044b\\u0435 \\u0438\\u0437 \\u043a\\u043e\\u043d\\u0444\\u0438\\u0433\\u0443\\u0440\\u0430\\u0446\\u0438\\u0438 Shopkeeper\\n *\\n *\\/\\n\\n$output = array();\\n\\n$get = $modx->getOption( \'get\', $scriptProperties, \'\' );\\n$post_name = explode( \',\', $modx->getOption( \'post_name\', $scriptProperties, $get ) );\\n$get = explode( \',\', $get );\\n$get = array_map( \'trim\', $get );\\n$post_name = array_map( \'trim\', $post_name );\\n$tpl = $modx->getOption( \'tpl\', $scriptProperties, \'\' );\\n$toPlaceholders = $modx->getOption( \'toPlaceholders\', $scriptProperties, false );\\n$pl_prefix = $modx->getOption( \'pl_prefix\', $scriptProperties, \'shkopt_\' );\\n\\nif( empty( $get ) ) return \'\';\\n\\nif( class_exists(\'Shopkeeper\') ){\\n    \\n    $config = Shopkeeper::getConfig( $get );\\n    \\n    \\/\\/echo \'<pre>\' . print_r( $config, true ) . \'<\\/pre>\';\\n    \\n    if( !empty( $config ) ){\\n        \\n        foreach( $get as $index => $opt_name ){\\n            \\n            if( !empty( $config[ $opt_name ] ) ){\\n                \\n                $output[ $opt_name ] = \'\';\\n                \\n                foreach( $config[ $opt_name ] as $key => $conf ){\\n                    \\n                    if( empty( $conf[\'value\'] ) ){\\n                        $conf[\'value\'] = $conf[\'label\'];\\n                    }\\n                    \\n                    $conf[\'selected\'] = ( isset( $post_name[$index] ) && isset( $_POST[ $post_name[$index] ] ) && $_POST[ $post_name[$index] ] == $conf[\'value\'] ? \'selected=\\"selected\\"\' : \'\' );\\n                    \\n                    $output[ $opt_name ] .= $modx->getChunk( $tpl, $conf ) . PHP_EOL . \\"\\\\t\\";\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\nif( $toPlaceholders ){\\n    \\n    foreach( $output as $pl_name => $out ){\\n        $modx->setPlaceholder( $pl_prefix . $pl_name, $out );\\n    }\\n    \\n    $output = array();\\n    \\n}\\n\\nreturn implode( \'\', $output );"}',
        'guid' => '3fc4ce1c4475851853131b2141111872',
        'native_key' => NULL,
        'signature' => 'e310112c82a12b30597f71ba03858f29',
      ),
      'ed02e0322dd076a2e7665cc52e999f4a' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"num_format","description":"Number format output filter","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/*\\n * numFormat snippet\\n * example: [[*price:num_format]]\\n *\\/\\n\\nif(strlen($input)==0) return \'\';\\n\\n$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));\\nreturn number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * numFormat snippet\\n * example: [[*price:num_format]]\\n *\\/\\n\\nif(strlen($input)==0) return \'\';\\n\\n$input = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $input));\\nreturn number_format($input,(floor($input) == $input ? 0 : 2),\'.\',\' \');"}',
        'guid' => 'e2931ca0848cf774ef9b03dfcae3405e',
        'native_key' => NULL,
        'signature' => 'd56d6550ad759592ce01a79d5d3fead6',
      ),
      'c1377e1f4568567c6be9e5026fabe660' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_curr_rate","description":"","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/*\\n * shk_curr_rate snippet\\n * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]\\n *\\/\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n\\n\\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * shk_curr_rate snippet\\n * example: [[!*price:shk_curr_rate]] [[!+shk_currency]]\\n *\\/\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$output = floatval(str_replace(array(\' \',\',\'), array(\'\',\'.\'), $scriptProperties[\'input\']));\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n\\n\\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n$output = shk_currency_calc( $scriptProperties, $output, $shk_currency );\\n\\nreturn $output;"}',
        'guid' => 'bf90a2ee12cbf2c0cc8ba6677ab28f69',
        'native_key' => NULL,
        'signature' => 'd733531cd80e5d1ce021ee82af7f6fe7',
      ),
      'fc235d2214ebb8cb07f85fc95f7f7466' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"param_edit_table","description":"Print options of product (param-edit)","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/\\/***********************************\\n\\/\\/\\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0434\\u043b\\u044f MODx 2.x\\n\\/\\/***********************************\\n\\n\\/*\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`param1`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&tvValue=`[[+tv.param1]]`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`all_width`\\n&postName=`w`\\n&tpl=`@CODE:\\n<select name=\\"w\\">\\n    <option value=\\"\\"><\\/option>\\n    [[+inner]]\\n<\\/select>\\n<!--tpl_separator-->\\n<option value=\\"[[+field1]]\\"[[+selected1]]>[[+field1]]<\\/option>\\n`]]\\n\\n\\u041f\\u0440\\u0438\\u043c\\u0435\\u0440\\u044b \\u0447\\u0430\\u043d\\u043a\\u0430:\\n\\n1.\\n\\n<h1>\\u0417\\u0430\\u0433\\u043e\\u043b\\u043e\\u0432\\u043e\\u043a<\\/h1>\\n[[+inner]]\\n<!--tpl_separator-->\\n<div class=\\"one\\">\\n    <img src=\\"[[+field1]]\\" width=\\"203\\" height=\\"144\\" alt=\\"\\" \\/>\\n    <h3>[[+field2]]<\\/h3>\\n    <p>[[+field3]]<\\/p>\\n<\\/div>\\n\\n2.\\n\\n<table>[[+inner]]<\\/table>\\n<!--tpl_separator-->\\n<tr>\\n    [[+inner]]\\n<\\/tr>\\n<!--tpl_separator-->\\n<td>[[+col_num]]. [[+field]]<\\/td>\\n\\n3.\\n\\n<div class=\\"product-options\\">\\n    [[+inner]]\\n<\\/div>\\n<!--tpl_separator-->\\n<label>\\n    <input type=\\"radio\\" class=\\"shk_param\\" value=\\"[[*idx]]__[[+field2]]\\" name=\\"size__[[+id]]\\" onclick=\\"SHK.additOpt(this)\\" [[+idx:eq=`0`:then=`checked`]] \\/>\\n    [[+field1]]\\n<\\/label>\\n\\n*\\/\\n\\n$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));\\n$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');\\n$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);\\n$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');\\n$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');\\n$postName_arr = explode(\',\',$postName);\\n$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');\\n$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);\\n$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);\\n$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');\\n$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);\\n$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');\\n$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');\\n$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');\\n$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');\\nif(!$tpl) return \'\';\\n$output = \'\';\\n$out_arr = array();\\n\\nif(!function_exists(\'fetchTpl\')){\\nfunction fetchTpl($tpl){\\n    global $modx;\\n    $template = \\"\\";\\n    if(substr($tpl, 0, 6) == \\"@FILE:\\"){\\n      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);\\n        $template = file_get_contents($tpl_file);\\n    }else if(substr($tpl, 0, 6) == \\"@CODE:\\"){\\n        $template = substr($tpl, 6);\\n    }else if($modx->getChunk($tpl) != \\"\\"){\\n        $template = $modx->getChunk($tpl);\\n    }else{\\n        $template = false;\\n    }\\n    return $template;\\n}\\n}\\n\\nif(!$tvValue){\\n    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));\\n    if($tv) $tvValue = $tv->getValue($docId);\\n}\\n$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));\\n$fields = $tvValue ? explode(\'||\',$tvValue) : array();\\nif(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);\\n\\n$row_unique = uniqid();\\n$col_unique = uniqid();\\n\\nif(count($fields)>0 && count($fields) >= $minCount){\\n\\n    foreach($fields as $key => $val){\\n        $row = explode(\'==\',$val);\\n        $rowArr = array();\\n        foreach($row as $k => $v){\\n            if(!empty($v) || !$noEmpty){\\n                \\n                $index = $separateCols ? $k : 0;\\n                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;\\n                \\n                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];\\n                if(isset($_POST[$postName])){\\n                    $selected = $_POST[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }if(isset($_GET[$postName])){\\n                    $selected = $_GET[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }else{\\n                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }\\n                \\n                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;\\n                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';\\n                \\n                if(!empty($rowChunk[2])){\\n                    $colArr = array(\\n                        $placeholderPrefix.\'col_num\' => $k+1,\\n                        $placeholderPrefix.\'field\' => $v,\\n                        $placeholderPrefix.\'idx\' => $key,\\n                        $placeholderPrefix.\'num\' => $key+1\\n                    );\\n                    $chunk = $modx->newObject(\'modChunk\');\\n                    $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$col_unique}\\",\'snippet\'=>$rowChunk[2]));\\n                    $chunk->setCacheable(false);\\n                    \\n                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);\\n                    \\n                }\\n            }\\n        }\\n        unset($k,$v);\\n        \\n        \\/\\/echo \'<pre>\'; print_r($rowArr); echo \'<\\/pre>\'; exit;\\n        \\n        foreach($rowArr as $k => $v){\\n            $chunk = $modx->newObject(\'modChunk\');\\n            $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$row_unique}\\",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));\\n            $chunk->setCacheable(false);\\n            $v[$placeholderPrefix.\'idx\'] = $key;\\n            $v[$placeholderPrefix.\'num\'] = $key+1;\\n            $v[$placeholderPrefix.\'id\'] = $docId;\\n            $temp_out = $chunk->process($v);\\n            if(!$noEmpty || ($temp_out != $rowChunk[1])){\\n                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';\\n                $out_arr[$k] .= $temp_out;\\n            }\\n        }\\n        unset($k,$v);\\n    }\\n    unset($key,$val);\\n    \\n    \\/\\/echo \'<pre>\'; print_r($out_arr); echo \'<\\/pre>\'; exit;\\n    \\n    if(strlen($out_arr[0])>0){\\n        $chunk = $modx->newObject(\'modChunk\');\\n        $chunk->fromArray(array(\'name\'=>\\"@INLINE-\\".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));\\n        $chunk->setCacheable(false);\\n        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));\\n        $output = $out_arr[0];\\n        \\n        \\/\\/\\u0421\\u0442\\u0430\\u0432\\u0438\\u043c \\u043e\\u0442\\u0434\\u0435\\u043b\\u044c\\u043d\\u044b\\u0435 \\u043f\\u043b\\u0435\\u0439\\u0441\\u0445\\u043e\\u043b\\u0434\\u0435\\u0440\\u044b \\u0434\\u043b\\u044f \\u0432\\u0441\\u0435\\u0445 \\u043a\\u043e\\u043b\\u043e\\u043d\\u043e\\u043a \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n        if($separateCols){\\n            array_shift($out_arr);\\n            array_shift($postName_arr);\\n            foreach($out_arr as $key => $val){\\n                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;\\n                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);\\n            }\\n        }\\n        \\n    }\\n\\n}else if($defaultValue && $defaultTpl){\\n    \\n    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));\\n    \\n}\\n\\nif($output && $toPlaceholder){\\n    $modx->setPlaceholder($toPlaceholder, $output);\\n    $output = \'\';\\n}\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/\\/***********************************\\n\\/\\/\\u0421\\u043d\\u0438\\u043f\\u043f\\u0435\\u0442 \\u0434\\u043b\\u044f MODx 2.x\\n\\/\\/***********************************\\n\\n\\/*\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`param1`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&tvValue=`[[+tv.param1]]`\\n&tpl=`properties_table`\\n]]\\n\\n[[param_edit_table?\\n&docId=`1`\\n&tvName=`all_width`\\n&postName=`w`\\n&tpl=`@CODE:\\n<select name=\\"w\\">\\n    <option value=\\"\\"><\\/option>\\n    [[+inner]]\\n<\\/select>\\n<!--tpl_separator-->\\n<option value=\\"[[+field1]]\\"[[+selected1]]>[[+field1]]<\\/option>\\n`]]\\n\\n\\u041f\\u0440\\u0438\\u043c\\u0435\\u0440\\u044b \\u0447\\u0430\\u043d\\u043a\\u0430:\\n\\n1.\\n\\n<h1>\\u0417\\u0430\\u0433\\u043e\\u043b\\u043e\\u0432\\u043e\\u043a<\\/h1>\\n[[+inner]]\\n<!--tpl_separator-->\\n<div class=\\"one\\">\\n    <img src=\\"[[+field1]]\\" width=\\"203\\" height=\\"144\\" alt=\\"\\" \\/>\\n    <h3>[[+field2]]<\\/h3>\\n    <p>[[+field3]]<\\/p>\\n<\\/div>\\n\\n2.\\n\\n<table>[[+inner]]<\\/table>\\n<!--tpl_separator-->\\n<tr>\\n    [[+inner]]\\n<\\/tr>\\n<!--tpl_separator-->\\n<td>[[+col_num]]. [[+field]]<\\/td>\\n\\n3.\\n\\n<div class=\\"product-options\\">\\n    [[+inner]]\\n<\\/div>\\n<!--tpl_separator-->\\n<label>\\n    <input type=\\"radio\\" class=\\"shk_param\\" value=\\"[[*idx]]__[[+field2]]\\" name=\\"size__[[+id]]\\" onclick=\\"SHK.additOpt(this)\\" [[+idx:eq=`0`:then=`checked`]] \\/>\\n    [[+field1]]\\n<\\/label>\\n\\n*\\/\\n\\n$docId = $modx->getOption(\'docId\',$scriptProperties,$modx->resource->get(\'id\'));\\n$tvName = $modx->getOption(\'tvName\',$scriptProperties,\'param\');\\n$s_id = $modx->getOption(\'id\',$scriptProperties,$tvName);\\n$tpl = $modx->getOption(\'tpl\',$scriptProperties,\'\');\\n$postName = $modx->getOption(\'postName\',$scriptProperties,\'none\');\\n$postName_arr = explode(\',\',$postName);\\n$tvValue = $modx->getOption(\'tvValue\',$scriptProperties,\'\');\\n$noEmpty = $modx->getOption(\'noEmpty\',$scriptProperties,true);\\n$separateCols = $modx->getOption(\'separateCols\',$scriptProperties,false);\\n$toPlaceholder = $modx->getOption(\'toPlaceholder\',$scriptProperties,\'\');\\n$minCount = $modx->getOption(\'minCount\',$scriptProperties,0);\\n$rowIndex = $modx->getOption(\'rowIndex\',$scriptProperties,\'\');\\n$defaultValue = $modx->getOption(\'defaultValue\',$scriptProperties,\'\');\\n$defaultTpl = $modx->getOption(\'defaultTpl\',$scriptProperties,\'\');\\n$placeholderPrefix = $modx->getOption(\'placeholderPrefix\',$scriptProperties,\'\');\\nif(!$tpl) return \'\';\\n$output = \'\';\\n$out_arr = array();\\n\\nif(!function_exists(\'fetchTpl\')){\\nfunction fetchTpl($tpl){\\n    global $modx;\\n    $template = \\"\\";\\n    if(substr($tpl, 0, 6) == \\"@FILE:\\"){\\n      $tpl_file = MODX_BASE_PATH . substr($tpl, 6);\\n        $template = file_get_contents($tpl_file);\\n    }else if(substr($tpl, 0, 6) == \\"@CODE:\\"){\\n        $template = substr($tpl, 6);\\n    }else if($modx->getChunk($tpl) != \\"\\"){\\n        $template = $modx->getChunk($tpl);\\n    }else{\\n        $template = false;\\n    }\\n    return $template;\\n}\\n}\\n\\nif(!$tvValue){\\n    $tv = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tvName));\\n    if($tv) $tvValue = $tv->getValue($docId);\\n}\\n$rowChunk = explode(\'<!--tpl_separator-->\', fetchTpl($tpl));\\n$fields = $tvValue ? explode(\'||\',$tvValue) : array();\\nif(strlen($rowIndex)>0) $fields = array_slice($fields, $rowIndex, 1);\\n\\n$row_unique = uniqid();\\n$col_unique = uniqid();\\n\\nif(count($fields)>0 && count($fields) >= $minCount){\\n\\n    foreach($fields as $key => $val){\\n        $row = explode(\'==\',$val);\\n        $rowArr = array();\\n        foreach($row as $k => $v){\\n            if(!empty($v) || !$noEmpty){\\n                \\n                $index = $separateCols ? $k : 0;\\n                $rowArr[$index][$placeholderPrefix.\'field\'.($separateCols ? \'1\' : ($k+1))] = $v;\\n                \\n                if(isset($postName_arr[$k])) $postName = $postName_arr[$k];\\n                if(isset($_POST[$postName])){\\n                    $selected = $_POST[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }if(isset($_GET[$postName])){\\n                    $selected = $_GET[$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }else{\\n                    $selected = isset($modx->placeholders[\'form_\'.$postName]) && $modx->placeholders[\'form_\'.$postName] == $v ? \' selected=\\"selected\\"\' : \'\';\\n                }\\n                \\n                $rowArr[$index][\'selected\'.($separateCols ? \'1\' : ($k+1))] = $selected;\\n                if(!isset($rowArr[$index][$placeholderPrefix.\'inner\'])) $rowArr[$index][$placeholderPrefix.\'inner\'] = \'\';\\n                \\n                if(!empty($rowChunk[2])){\\n                    $colArr = array(\\n                        $placeholderPrefix.\'col_num\' => $k+1,\\n                        $placeholderPrefix.\'field\' => $v,\\n                        $placeholderPrefix.\'idx\' => $key,\\n                        $placeholderPrefix.\'num\' => $key+1\\n                    );\\n                    $chunk = $modx->newObject(\'modChunk\');\\n                    $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$col_unique}\\",\'snippet\'=>$rowChunk[2]));\\n                    $chunk->setCacheable(false);\\n                    \\n                    $rowArr[$index][$placeholderPrefix.\'inner\'] .= $chunk->process($colArr);\\n                    \\n                }\\n            }\\n        }\\n        unset($k,$v);\\n        \\n        \\/\\/echo \'<pre>\'; print_r($rowArr); echo \'<\\/pre>\'; exit;\\n        \\n        foreach($rowArr as $k => $v){\\n            $chunk = $modx->newObject(\'modChunk\');\\n            $chunk->fromArray(array(\'name\'=>\\"@INLINE-{$row_unique}\\",\'snippet\'=>(isset($rowChunk[1]) ? $rowChunk[1] : \'\')));\\n            $chunk->setCacheable(false);\\n            $v[$placeholderPrefix.\'idx\'] = $key;\\n            $v[$placeholderPrefix.\'num\'] = $key+1;\\n            $v[$placeholderPrefix.\'id\'] = $docId;\\n            $temp_out = $chunk->process($v);\\n            if(!$noEmpty || ($temp_out != $rowChunk[1])){\\n                if(!isset($out_arr[$k])) $out_arr[$k] = \'\';\\n                $out_arr[$k] .= $temp_out;\\n            }\\n        }\\n        unset($k,$v);\\n    }\\n    unset($key,$val);\\n    \\n    \\/\\/echo \'<pre>\'; print_r($out_arr); echo \'<\\/pre>\'; exit;\\n    \\n    if(strlen($out_arr[0])>0){\\n        $chunk = $modx->newObject(\'modChunk\');\\n        $chunk->fromArray(array(\'name\'=>\\"@INLINE-\\".uniqid(),\'snippet\'=>(isset($rowChunk[0]) ? $rowChunk[0] : \'\')));\\n        $chunk->setCacheable(false);\\n        $out_arr[0] = $chunk->process(array($placeholderPrefix.\'inner\'=>$out_arr[0]));\\n        $output = $out_arr[0];\\n        \\n        \\/\\/\\u0421\\u0442\\u0430\\u0432\\u0438\\u043c \\u043e\\u0442\\u0434\\u0435\\u043b\\u044c\\u043d\\u044b\\u0435 \\u043f\\u043b\\u0435\\u0439\\u0441\\u0445\\u043e\\u043b\\u0434\\u0435\\u0440\\u044b \\u0434\\u043b\\u044f \\u0432\\u0441\\u0435\\u0445 \\u043a\\u043e\\u043b\\u043e\\u043d\\u043e\\u043a \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n        if($separateCols){\\n            array_shift($out_arr);\\n            array_shift($postName_arr);\\n            foreach($out_arr as $key => $val){\\n                $temp_id = isset($postName_arr[$key]) ? $postName_arr[$key] : $key+1;\\n                $modx->setPlaceholder($s_id.\'_\'.$temp_id, $val);\\n            }\\n        }\\n        \\n    }\\n\\n}else if($defaultValue && $defaultTpl){\\n    \\n    $output = $modx->getChunk($defaultTpl, array(\'value\'=>$defaultValue));\\n    \\n}\\n\\nif($output && $toPlaceholder){\\n    $modx->setPlaceholder($toPlaceholder, $output);\\n    $output = \'\';\\n}\\n\\nreturn $output;"}',
        'guid' => '032b1be411ed683cb181674a3a2c533c',
        'native_key' => NULL,
        'signature' => 'e2402f24b825fccc73b342a78bd93088',
      ),
      '7a2a5d8928be2e1d2d9d6cbe0d44be29' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_sitemap","description":"Create sitemap.xml for catalog","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/**\\n * snippet shk_sitemap\\n *\\n * @author slaad\\n * \\n *\\/\\n\\n\\/*\\n\\nhttp:\\/\\/modx-shopkeeper.ru\\/forum\\/viewtopic.php?pid=20545#p20545\\n\\nExamples\\n\\n1. Only resources (one or more contexts):\\n\\n[[shk_sitemap?\\n&packageNames=`modResource`\\n&classNames=`modResource`\\n]]\\n\\n2. Resources and shop package (Shopkeeper), two contexts:\\n\\n[[shk_sitemap?\\n&packageNames=`modResource,shop`\\n&classNames=`modResource,ShopContent`\\n&contexts=`web,catalog`\\n]]\\n\\n*\\/\\n\\n$config =  array( \\n    \'packageNames\' => \'modResource,shop\',\\n    \'classNames\' => \'modResource,ShopContent\',\\n    \'contexts\' => \'web,catalog\'\\n);\\n\\n$config = array_merge( $config, $scriptProperties );\\n$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n$config[\'urlSuffix\'] = $contentType->getExtension();\\n$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');\\n\\n$output = \\"<?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"UTF-8\\\\\\"\\n<urlset xmlns=\\\\\\"http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\\\\\\">\\" . PHP_EOL;\\n\\nif(!function_exists(\'getMapQuery\')){\\nfunction getMapQuery($className,$select){\\n    global $modx;\\n        $query = $modx->newQuery($className);\\n        $query->select($select);\\n        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );\\n        if ( $query->prepare() && $query->stmt->execute() ){     \\n            $query_out= array();\\n            \\/\\/$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());\\n            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);\\n            \\n            foreach($query_out as $r){\\n                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();\\n                foreach ($select as $s){\\n                    $resources[$r[\'id\']][$s] = $r[$s];\\n                }\\n            }         \\n        }\\n        return $resources;\\n    }\\n}\\n\\n$packageNames = explode(\',\',$config[\'packageNames\']);\\n$classNames = explode(\',\',$config[\'classNames\']);\\n$contexts = explode(\',\',$config[\'contexts\']);\\n\\nforeach ( $packageNames as $key => $packageName ){\\n    \\n    $parentName = $packageName == \'modResource\' ? \\"parent\\" : \\"resource_id\\";\\n    $select = array(\'id\',\'alias\',\'editedon\',$parentName);\\n    if( $packageName != \'modResource\' ){\\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $packageName . \'\\/model\\/\';\\n        $modx->addPackage($packageName, $modelpath);\\n    }\\n    else{\\n        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );\\n    }\\n    \\n    $resources = getMapQuery($classNames[$key],$select);\\n    \\n    foreach ( $resources as $resource ){\\n        \\n        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];\\n        if ( $resource[$parentName] != 0 ){\\n            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');\\n        }\\n        else{\\n            $url = $modx->getOption(\'site_url\');\\n        }\\n        $url .= $resource[\'alias\'];\\n        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];\\n        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];\\n        $date = strftime( \'%Y-%m-%d\', $editedon );\\n        $output .= \\"\\n        <url>\\n            <loc>{$url}<\\/loc>\\n            <lastmod>{$date}<\\/lastmod>\\n            <priority>0.9<\\/priority>\\n            <changefreq>monthly<\\/changefreq>\\n        <\\/url>\\";\\n    }\\n\\n}\\n\\n$output .= PHP_EOL . \\"<\\/urlset>\\";\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/**\\n * snippet shk_sitemap\\n *\\n * @author slaad\\n * \\n *\\/\\n\\n\\/*\\n\\nhttp:\\/\\/modx-shopkeeper.ru\\/forum\\/viewtopic.php?pid=20545#p20545\\n\\nExamples\\n\\n1. Only resources (one or more contexts):\\n\\n[[shk_sitemap?\\n&packageNames=`modResource`\\n&classNames=`modResource`\\n]]\\n\\n2. Resources and shop package (Shopkeeper), two contexts:\\n\\n[[shk_sitemap?\\n&packageNames=`modResource,shop`\\n&classNames=`modResource,ShopContent`\\n&contexts=`web,catalog`\\n]]\\n\\n*\\/\\n\\n$config =  array( \\n    \'packageNames\' => \'modResource,shop\',\\n    \'classNames\' => \'modResource,ShopContent\',\\n    \'contexts\' => \'web,catalog\'\\n);\\n\\n$config = array_merge( $config, $scriptProperties );\\n$contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n$config[\'urlSuffix\'] = $contentType->getExtension();\\n$config[\'containerSuffix\'] = $modx->getOption(\'container_suffix\');\\n\\n$output = \\"<?xml version=\\\\\\"1.0\\\\\\" encoding=\\\\\\"UTF-8\\\\\\"\\n<urlset xmlns=\\\\\\"http:\\/\\/www.sitemaps.org\\/schemas\\/sitemap\\/0.9\\\\\\">\\" . PHP_EOL;\\n\\nif(!function_exists(\'getMapQuery\')){\\nfunction getMapQuery($className,$select){\\n    global $modx;\\n        $query = $modx->newQuery($className);\\n        $query->select($select);\\n        $query->where( array( \'published\' => 1, \'hidemenu\' => 0 ) );\\n        if ( $query->prepare() && $query->stmt->execute() ){     \\n            $query_out= array();\\n            \\/\\/$modx->log(modX::LOG_LEVEL_ERROR, $query->toSql());\\n            $query_out=$query->stmt->fetchAll(PDO::FETCH_ASSOC);\\n            \\n            foreach($query_out as $r){\\n                if (!isset($resources[$r[\'id\']])) $resources[$r[\'id\']]=array();\\n                foreach ($select as $s){\\n                    $resources[$r[\'id\']][$s] = $r[$s];\\n                }\\n            }         \\n        }\\n        return $resources;\\n    }\\n}\\n\\n$packageNames = explode(\',\',$config[\'packageNames\']);\\n$classNames = explode(\',\',$config[\'classNames\']);\\n$contexts = explode(\',\',$config[\'contexts\']);\\n\\nforeach ( $packageNames as $key => $packageName ){\\n    \\n    $parentName = $packageName == \'modResource\' ? \\"parent\\" : \\"resource_id\\";\\n    $select = array(\'id\',\'alias\',\'editedon\',$parentName);\\n    if( $packageName != \'modResource\' ){\\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $packageName . \'\\/model\\/\';\\n        $modx->addPackage($packageName, $modelpath);\\n    }\\n    else{\\n        $select = array_merge( $select, array(\'context_key\',\'isfolder\') );\\n    }\\n    \\n    $resources = getMapQuery($classNames[$key],$select);\\n    \\n    foreach ( $resources as $resource ){\\n        \\n        if (!isset($resource[\'context_key\'])) $resource[\'context_key\'] = !empty( $contexts[$key] ) ? $contexts[$key] : $contexts[0];\\n        if ( $resource[$parentName] != 0 ){\\n            $url = $modx->makeUrl($resource[$parentName],$resource[\'context_key\'],\'\',\'full\');\\n        }\\n        else{\\n            $url = $modx->getOption(\'site_url\');\\n        }\\n        $url .= $resource[\'alias\'];\\n        $url .= !empty( $resource[\'isfolder\'] ) ? $config[\'containerSuffix\'] : $config[\'urlSuffix\'];\\n        $editedon = !empty( $resource[\'editedon\'] ) ? $resource[\'editedon\'] : $resource[\'createdon\'];\\n        $date = strftime( \'%Y-%m-%d\', $editedon );\\n        $output .= \\"\\n        <url>\\n            <loc>{$url}<\\/loc>\\n            <lastmod>{$date}<\\/lastmod>\\n            <priority>0.9<\\/priority>\\n            <changefreq>monthly<\\/changefreq>\\n        <\\/url>\\";\\n    }\\n\\n}\\n\\n$output .= PHP_EOL . \\"<\\/urlset>\\";\\n\\nreturn $output;"}',
        'guid' => 'a56dca7628f4724dab542afbbe6dea56',
        'native_key' => NULL,
        'signature' => '903c91b0250628e058dfb0f9bd7e18f2',
      ),
      '59203794d93ab52485d9b2eb2149c804' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'class' => 'modSnippet',
        'object' => '{"id":null,"source":1,"property_preprocess":0,"name":"shk_render_tv","description":"Render parameters for products as checkbox, radio, select.","editor_type":0,"category":0,"cache_type":0,"snippet":"\\/*\\n\\nshk_render_tv\\n\\n[[*param1:shk_render_tv=`shk_select`]]\\n\\n[[*param1:shk_render_tv=`shk_checkbox`]]\\n\\n[[*param1:shk_render_tv=`shk_radio`]]\\n\\n[[shk_render_tv?input=`[[+tv.param1]]`&options=`shk_select`&resourceId=`[[+id]]`]]\\n\\n*\\/\\n\\n$input = $modx->getOption(\'input\',$scriptProperties,\'\');\\n$options = $modx->getOption(\'options\',$scriptProperties,\'shk_select\');\\n$resourceId = $modx->getOption(\'resourceId\',$scriptProperties,$modx->resource->id);\\n$tv_name = $modx->getOption(\'name\',$scriptProperties,\'tv\');\\n$wraptag = $modx->getOption(\'wraptag\',$scriptProperties,\'div\');\\n$first_selected = $modx->getOption(\'first_selected\',$scriptProperties,true);\\n\\n$output = \'\';\\n\\nif($input){\\n    \\n    $tv = $modx->newObject(\'modTemplateVar\');\\n    $tv->set(\'name\', $tv_name);\\n    $tv->set(\'display\', $options);\\n    $tv->set(\'value\', $input);\\n    \\n    $params = array(\\n        \'id\' => $resourceId,\\n        \'param_name\' => $tv_name,\\n        \'wraptag\' => $wraptag,\\n        \'first_selected\' => $first_selected,\\n        \'function\' => \'SHK.additOpt(this)\'\\n    );\\n    $outputRenderPaths = $tv->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n    \\n    $value = $tv->prepareOutput($input);\\n    $output = $tv->getRender($params, $value, $outputRenderPaths, \'output\', $resourceId, $options);\\n    \\n}\\n\\nreturn $output;","locked":0,"properties":null,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n\\nshk_render_tv\\n\\n[[*param1:shk_render_tv=`shk_select`]]\\n\\n[[*param1:shk_render_tv=`shk_checkbox`]]\\n\\n[[*param1:shk_render_tv=`shk_radio`]]\\n\\n[[shk_render_tv?input=`[[+tv.param1]]`&options=`shk_select`&resourceId=`[[+id]]`]]\\n\\n*\\/\\n\\n$input = $modx->getOption(\'input\',$scriptProperties,\'\');\\n$options = $modx->getOption(\'options\',$scriptProperties,\'shk_select\');\\n$resourceId = $modx->getOption(\'resourceId\',$scriptProperties,$modx->resource->id);\\n$tv_name = $modx->getOption(\'name\',$scriptProperties,\'tv\');\\n$wraptag = $modx->getOption(\'wraptag\',$scriptProperties,\'div\');\\n$first_selected = $modx->getOption(\'first_selected\',$scriptProperties,true);\\n\\n$output = \'\';\\n\\nif($input){\\n    \\n    $tv = $modx->newObject(\'modTemplateVar\');\\n    $tv->set(\'name\', $tv_name);\\n    $tv->set(\'display\', $options);\\n    $tv->set(\'value\', $input);\\n    \\n    $params = array(\\n        \'id\' => $resourceId,\\n        \'param_name\' => $tv_name,\\n        \'wraptag\' => $wraptag,\\n        \'first_selected\' => $first_selected,\\n        \'function\' => \'SHK.additOpt(this)\'\\n    );\\n    $outputRenderPaths = $tv->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n    \\n    $value = $tv->prepareOutput($input);\\n    $output = $tv->getRender($params, $value, $outputRenderPaths, \'output\', $resourceId, $options);\\n    \\n}\\n\\nreturn $output;"}',
        'guid' => 'b7f0b2f95444c6ca8452deb81d5ddb2b',
        'native_key' => NULL,
        'signature' => 'e39e4315de238762c05139c43d98bef0',
      ),
    ),
    'Plugins' => 
    array (
      '9f8598c49dbc5465a9690afb4da63eb9' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '90fe9c4f2e8df556b2a5e36ae393d400' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnHandleRequest","priority":0,"propertyset":0}',
              'guid' => '6790062eb7ad7bd3d36d4eaabb1275a8',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnHandleRequest',
              ),
              'signature' => 'ee90f3cde43351e9b29fb50db6a59ef5',
            ),
            '1264821cae77e9a03711993da2eae496' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnPageNotFound","priority":0,"propertyset":0}',
              'guid' => 'd56885eff2db3e0c60c47db6894d4db4',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnPageNotFound',
              ),
              'signature' => '3bab3e449e775bd94c78cb698132fef7',
            ),
            '403bd596286a7b38f459c4e98983a7da' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnWebPageComplete","priority":0,"propertyset":0}',
              'guid' => 'c5e05ddc40a3ede3d755e2f543234283',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnWebPageComplete',
              ),
              'signature' => '1e7bbcfd15d41d4fed8499d3b966abbb',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_contextSwitch","description":"Switch to catalog context.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n\\n plugin contextSwitch\\n \\n System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete\\n\\n*\\/\\n\\n\\/\\/ini_set( \'display_errors\', 1 );\\n\\/\\/error_reporting(E_ALL);\\n\\nif($modx->context->get(\'key\') == \'mgr\') return \'\';\\n\\n$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');\\/\\/shop\\n$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');\\/\\/ShopContent\\n$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);\\n$debug = $modx->getOption(\'debug\',$scriptProperties,false);\\n$cacheOptions = array(\\n    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),\\n    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),\\n    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),\\n    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),\\n    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),\\n    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)\\n);\\n\\nswitch($modx->event->name){\\n    \\n    case \\"OnHandleRequest\\":\\n        \\n        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');\\n        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');\\n        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);\\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);\\n        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');\\n        $site_start = $modx->getOption(\'site_start\', null, 1);\\n        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'\\/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];\\n        if( strpos( $request_uri, \'\\/\' ) !== false ){\\n            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'\\/\' ) );\\n        }else{\\n            $lang_key = $request_uri;\\n        }\\n        \\n        if( !$context_key ) return \'\';\\n        \\n        if( $modx->config[\'friendly_urls\'] ){\\n            \\n            if( $request_uri ){\\n                \\n                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n                $html_ext = $contentType->getExtension();\\n                \\n                $base_dir_alias = current( explode( \'\\/\', $request_uri ) );\\n                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){\\n                    $base_dir_alias .= $container_suffix;\\n                }\\n                if( !$container_suffix && $html_ext ){\\n                    $base_dir_alias .= $html_ext;\\n                }\\n                \\n                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );\\n                \\n                \\/\\/\\u041f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e \\u043b\\u0438 \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\n                $switch_action = false;\\n                foreach( $context_child_ids as $id ){\\n                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );\\n                    if( $temp_url == $base_dir_alias ){\\n                        $switch_action = true;\\n                        break;\\n                    }\\n                }\\n                \\n                if( $switch_action ){\\n                    $modx->reloadContext( $context_key );\\n                    $modx->switchContext( $context_key );\\n                    $modx->config[\'site_start\'] = $site_start;\\n                    $modx->setPlaceholder( \'context_key\', $context_key );\\n                }\\n                \\n            }\\n            \\n        }else{\\n            \\n            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;\\n            if(!$requestId) return \'\';\\n            $resource = $modx->getObject( \'modResource\', $requestId );\\n            if( $resource && $resource->get(\'context_key\') == $context_key ){\\n                $modx->reloadContext( $context_key );\\n                $modx->switchContext( $context_key );\\n                $modx->config[\'site_start\'] = $site_start;\\n                $modx->setPlaceholder( \'context_key\', $context_key );\\n            }\\n            \\n        }\\n    \\n    break;\\n    case \\"OnPageNotFound\\":\\n        \\n        if(!$prodClassName || $prodClassName==\'modResource\') break;\\n        \\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');\\n        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');\\n        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';\\n        \\n        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n        $html_ext = $contentType->getExtension();\\n\\n        $short_url = $html_ext\\n            ? substr( $url, 0, ( 0 - strlen( $html_ext ) ) )\\n            : $url;\\n        \\n        $parent_url = strpos( $short_url, \'\\/\' ) !== false\\n            ? substr( $short_url, 0, strrpos( $short_url, \'\\/\' ) ) . $container_suffix\\n            : \'\';\\n\\n        $prod_alias = strpos( $short_url, \'\\/\' ) !== false\\n            ? substr( $short_url, (strrpos( $short_url, \'\\/\' )+1) )\\n            : $short_url;\\n\\n        $resourceIdentifier = $modx->findResource($parent_url);\\n        if(!$resourceIdentifier) return \'\';\\n        \\n        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );\\n        if( !$resource ) return \'\';\\n        \\n        \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0448\\u0430\\u0431\\u043b\\u043e\\u043d\\u0430\\n        $templateObj = $resource->getOne(\'Template\');\\n        $templateProps = !empty($templateObj) ? $templateObj->getProperties() : array();\\n        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];\\n        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];\\n        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];\\n        \\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $prodPackageName . \'\\/model\\/\';\\n        $modx->addPackage($prodPackageName, $modelpath);\\n        \\n        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );\\n        \\n        if($product){\\n            \\n            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);\\n            $product->set(\'parent\',$resourceIdentifier);\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$product->get(\'id\');\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            \\/\\/\\u0412\\u044b\\u0442\\u0430\\u0441\\u043a\\u0438\\u0432\\u0430\\u0435\\u043c \\u0438\\u0437 \\u043a\\u044d\\u0448\\u0430\\n            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {\\n                \\n                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);\\n                \\n                if ($modx->resource) {\\n                    \\n                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);\\n                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];\\n                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);\\n                    \\n                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];\\n                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];\\n                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');\\n                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');\\n                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));\\n                    $isForward = $modx->resource->_isForward;\\n                    $modx->resource->setProcessed(true);\\n                    $fromCache = true;\\n                    \\n                    $modx->invokeEvent(\'OnLoadWebPageCache\');\\n                    \\n                }\\n            \\n            \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0432 \\u043a\\u044d\\u0448\\u0435 \\u043d\\u0435\\u0442, \\u0441\\u043e\\u0437\\u0434\\u0430\\u0451\\u043c \\u043d\\u043e\\u0432\\u044b\\u0439 \\u0432\\u0438\\u0440\\u0442\\u0443\\u0430\\u043b\\u044c\\u043d\\u044b\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441 \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            }else{\\n                \\n                $modx->resource = $modx->newObject(\'modResource\');\\n                \\/\\/$modx->resource->set();\\n                \\n                ####################################################\\n                \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f \\u043f\\u043e \\u0442\\u0438\\u043f\\u0430\\u043c \\u0432\\u0432\\u043e\\u0434\\u0430 \\u0441\\u0432\\u044f\\u0437\\u0430\\u043d\\u043d\\u044b\\u0445 TV\\n                $product_fields = $product->toArray();\\n                $field_tv = array();\\n                \\n                $sql = \\"\\n                SELECT `formtabs`\\n                FROM `\\".$modx->config[\'table_prefix\'].\\"migx_configs`\\n                WHERE `name` = \'{$prodPackageName}\'\\n                \\";\\n                $stmt = $modx->prepare($sql);\\n                if ($stmt && $stmt->execute()) {\\n                    $migx_config_formtabs = $stmt->fetchColumn();\\n                    if($migx_config_formtabs){\\n                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);\\n                        foreach($migx_config_formtabs_arr as $formtabs){\\n                            \\n                            if(!empty($formtabs[\'fields\'])){\\n                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];\\n                            }else{\\n                                $temp_fields = array();\\n                            }\\n                            \\n                            foreach($temp_fields as $temp_field){\\n                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];\\n                            }\\n                        }\\n                        \\n                    }\\n                }\\n                $stmt->closeCursor();\\n                \\n                foreach($field_tv as $field_name => $tv_name){\\n                    if(isset($product_fields[$field_name])){\\n                        \\n                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));\\n                        if( is_object($tv_object) ){\\n                            if($tv_object->get(\'display\')==\'default\') continue;\\n                            \\n                            $tv_object->set(\'name\',$field_name);\\n                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));\\n                            $tv_object->set(\'output_properties\',$output_properties);\\n                            $tv_object->set(\'value\',$product_fields[$field_name]);\\n                            \\n                            $value = $product_fields[$field_name];\\n                            $value = $tv_object->prepareOutput($value);\\n                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n                            \\n                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));\\n                            \\n                            $product_fields[$field_name] = $value;\\n                        }\\n                    }\\n                }\\n                ####################################################\\n                \\n                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));\\n                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);\\n                \\n                $modx->resource->set(\'id\',$product->get(\'id\'));\\n                $modx->resource->set(\'cacheable\',false);\\n                $modx->resource->set(\'class_key\',$prodClassName);\\n                $modx->resource->_content = \'\';\\n                $modx->resource->_output = \'\';\\n                $modx->resource->_isForward = true;\\n                \\/\\/$modx->resource->_class = $prodClassName;\\n                \\n                $modx->elementCache = array();\\n                $modx->resourceGenerated = true;\\n                unset($resource);\\n                \\n            }\\n            \\n            unset($product);\\n            \\n            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'<\\/pre>\'; exit; }\\n            \\n            \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u0438 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u043c HTML-\\u043a\\u043e\\u0434 \\u0441\\u0442\\u0440\\u0430\\u043d\\u0438\\u0446\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            $modx->resourceIdentifier = $modx->resource->get(\'id\');\\n            $modx->resourceMethod = \'id\';\\n            \\n            $modx->request->prepareResponse();\\n            \\n        }\\n        \\n    break;\\n\\n    case \\"OnWebPageComplete\\":\\n        \\n        if(!$prodClassName || $prodClassName == \'modResource\') break;\\n        \\n        $results= array();\\n        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {\\n            \\n            if( $modx->resource->class_key != $prodClassName ) break;\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$modx->resource->get(\'id\');\\n            \\n            \\/\\/$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));\\n            \\/\\/$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {\\n                \\n                $results[\'resourceClass\'] = $modx->resource->_class;\\n                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();\\n                $results[\'resource\']= $modx->resource->toArray(\'\', true);\\n                $results[\'resource\'][\'_content\']= $modx->resource->_content;\\n                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;\\n                if ($contentType = $modx->resource->getOne(\'ContentType\')) {\\n                    $results[\'contentType\']= $contentType->toArray(\'\', true);\\n                }\\n                $results[\'resourceGroups\']= array();\\n                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';\\n                $policies = $modx->resource->findPolicy($context);\\n                if (is_array($policies)) {\\n                    $results[\'policyCache\']= $policies;\\n                }\\n                if (!empty($modx->elementCache)) {\\n                    $results[\'elementCache\']= $modx->elementCache;\\n                }\\n                if (!empty($modx->sourceCache)) {\\n                    $results[\'sourceCache\']= $modx->sourceCache;\\n                }\\n                if (!empty($modx->resource->_sjscripts)) {\\n                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;\\n                }\\n                if (!empty($modx->resource->_jscripts)) {\\n                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;\\n                }\\n                if (!empty($modx->resource->_loadedjscripts)) {\\n                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;\\n                }\\n                \\n                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));\\n                \\n                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {\\n                    $modx->log( modX::LOG_LEVEL_ERROR, \\"[contextSwitch] Could not cache resource \\" . $modx->resource->get(\'id\') );\\n                }\\n                \\n            }\\n            \\n            unset($cachedResource);\\n            \\n        }\\n        \\n    break;\\n\\n}\\n\\nreturn \'\';","locked":0,"properties":"a:8:{s:19:\\"context_param_alias\\";a:7:{s:4:\\"name\\";s:19:\\"context_param_alias\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"c\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:16:\\"request_param_id\\";a:7:{s:4:\\"name\\";s:16:\\"request_param_id\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:2:\\"id\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:10:\\"catalog_id\\";a:7:{s:4:\\"name\\";s:10:\\"catalog_id\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"0\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:11:\\"context_key\\";a:7:{s:4:\\"name\\";s:11:\\"context_key\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:7:\\"catalog\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:10:\\"site_start\\";a:7:{s:4:\\"name\\";s:10:\\"site_start\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:15:\\"prodPackageName\\";a:7:{s:4:\\"name\\";s:15:\\"prodPackageName\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:13:\\"prodClassName\\";a:7:{s:4:\\"name\\";s:13:\\"prodClassName\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:0:\\"\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:14:\\"prodTemplateId\\";a:7:{s:4:\\"name\\";s:14:\\"prodTemplateId\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"1\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}}","disabled":0,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n\\n plugin contextSwitch\\n \\n System event: OnHandleRequest, OnPageNotFound, OnWebPageComplete\\n\\n*\\/\\n\\n\\/\\/ini_set( \'display_errors\', 1 );\\n\\/\\/error_reporting(E_ALL);\\n\\nif($modx->context->get(\'key\') == \'mgr\') return \'\';\\n\\n$prodPackageName = $modx->getOption(\'prodPackageName\',$scriptProperties,\'\');\\/\\/shop\\n$prodClassName = $modx->getOption(\'prodClassName\',$scriptProperties,\'\');\\/\\/ShopContent\\n$prodTemplateId = $modx->getOption(\'prodTemplateId\',$scriptProperties,1);\\n$debug = $modx->getOption(\'debug\',$scriptProperties,false);\\n$cacheOptions = array(\\n    xPDO::OPT_CACHE_KEY => $modx->getOption(\'cache_resource_key\', $scriptProperties, \'resource\'),\\n    xPDO::OPT_CACHE_HANDLER => $modx->getOption(\'cache_resource_handler\', $scriptProperties, \'xPDOFileCache\'),\\n    xPDO::OPT_CACHE_EXPIRES => (integer) $modx->getOption(\'cache_resource_expires\', $scriptProperties, 0),\\n    xPDO::OPT_CACHE_FORMAT => (integer) $modx->getOption(\'cache_resource_format\', $scriptProperties, xPDOCacheManager::CACHE_PHP),\\n    xPDO::OPT_CACHE_ATTEMPTS => (integer) $modx->cacheManager->getOption(\'cache_resource_attempts\', null, 1),\\n    xPDO::OPT_CACHE_ATTEMPT_DELAY => (integer) $modx->cacheManager->getOption(\'cache_resource_attempt_delay\', null, 1000)\\n);\\n\\nswitch($modx->event->name){\\n    \\n    case \\"OnHandleRequest\\":\\n        \\n        $cntxt_param = $modx->getOption(\'context_param_alias\', null, \'c\');\\n        $request_param_id = $modx->getOption(\'request_param_id\', null, \'id\');\\n        $friendly_urls = $modx->getOption(\'friendly_urls\', null, true);\\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $catalog_id = $modx->getOption(\'catalog_id\',$scriptProperties,0);\\n        $context_key = $modx->getOption(\'context_key\',$scriptProperties,\'\');\\n        $site_start = $modx->getOption(\'site_start\', null, 1);\\n        $request_uri = substr($_SERVER[\'REQUEST_URI\'],0,1)==\'\\/\' ? substr($_SERVER[\'REQUEST_URI\'],1) : $_SERVER[\'REQUEST_URI\'];\\n        if( strpos( $request_uri, \'\\/\' ) !== false ){\\n            $lang_key = substr( $request_uri, 0, strpos( $request_uri, \'\\/\' ) );\\n        }else{\\n            $lang_key = $request_uri;\\n        }\\n        \\n        if( !$context_key ) return \'\';\\n        \\n        if( $modx->config[\'friendly_urls\'] ){\\n            \\n            if( $request_uri ){\\n                \\n                $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n                $html_ext = $contentType->getExtension();\\n                \\n                $base_dir_alias = current( explode( \'\\/\', $request_uri ) );\\n                if( strlen( $container_suffix ) > 1 && strpos( $base_dir_alias, $container_suffix ) === false ){\\n                    $base_dir_alias .= $container_suffix;\\n                }\\n                if( !$container_suffix && $html_ext ){\\n                    $base_dir_alias .= $html_ext;\\n                }\\n                \\n                $context_child_ids = $modx->getChildIds( 0, 1, array( \'context\' => $context_key ) );\\n                \\n                \\/\\/\\u041f\\u0440\\u043e\\u0432\\u0435\\u0440\\u044f\\u0435\\u043c \\u043d\\u0443\\u0436\\u043d\\u043e \\u043b\\u0438 \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0442\\u044c \\u043a\\u043e\\u043d\\u0442\\u0435\\u043a\\u0441\\u0442\\n                $switch_action = false;\\n                foreach( $context_child_ids as $id ){\\n                    $temp_url = basename( $modx->makeURL( $id,$context_key, \'\', \'abs\' ) );\\n                    if( $temp_url == $base_dir_alias ){\\n                        $switch_action = true;\\n                        break;\\n                    }\\n                }\\n                \\n                if( $switch_action ){\\n                    $modx->reloadContext( $context_key );\\n                    $modx->switchContext( $context_key );\\n                    $modx->config[\'site_start\'] = $site_start;\\n                    $modx->setPlaceholder( \'context_key\', $context_key );\\n                }\\n                \\n            }\\n            \\n        }else{\\n            \\n            $requestId = !empty($_REQUEST[$request_param_id]) && is_numeric($_REQUEST[$request_param_id]) ? $_REQUEST[$request_param_id] : 0;\\n            if(!$requestId) return \'\';\\n            $resource = $modx->getObject( \'modResource\', $requestId );\\n            if( $resource && $resource->get(\'context_key\') == $context_key ){\\n                $modx->reloadContext( $context_key );\\n                $modx->switchContext( $context_key );\\n                $modx->config[\'site_start\'] = $site_start;\\n                $modx->setPlaceholder( \'context_key\', $context_key );\\n            }\\n            \\n        }\\n    \\n    break;\\n    case \\"OnPageNotFound\\":\\n        \\n        if(!$prodClassName || $prodClassName==\'modResource\') break;\\n        \\n        $container_suffix = $modx->getOption(\'container_suffix\', null, \'\');\\n        $request_param_alias = $modx->getOption(\'request_param_alias\',null,\'q\');\\n        $request_param_id = $modx->getOption(\'request_param_id\',null,\'id\');\\n        $url = isset($_GET[$request_param_alias]) ? $_GET[$request_param_alias] : \'\';\\n        \\n        $contentType = $modx->getObject(\'modContentType\',array(\'name\'=>\'HTML\'));\\n        $html_ext = $contentType->getExtension();\\n\\n        $short_url = $html_ext\\n            ? substr( $url, 0, ( 0 - strlen( $html_ext ) ) )\\n            : $url;\\n        \\n        $parent_url = strpos( $short_url, \'\\/\' ) !== false\\n            ? substr( $short_url, 0, strrpos( $short_url, \'\\/\' ) ) . $container_suffix\\n            : \'\';\\n\\n        $prod_alias = strpos( $short_url, \'\\/\' ) !== false\\n            ? substr( $short_url, (strrpos( $short_url, \'\\/\' )+1) )\\n            : $short_url;\\n\\n        $resourceIdentifier = $modx->findResource($parent_url);\\n        if(!$resourceIdentifier) return \'\';\\n        \\n        $resource = $modx->getObject( \'modResource\', array( \'id\' => $resourceIdentifier, \'published\' => true, \'deleted\' => false ) );\\n        if( !$resource ) return \'\';\\n        \\n        \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b \\u0448\\u0430\\u0431\\u043b\\u043e\\u043d\\u0430\\n        $templateObj = $resource->getOne(\'Template\');\\n        $templateProps = !empty($templateObj) ? $templateObj->getProperties() : array();\\n        if(!empty($templateProps[\'prodPackageName\'])) $prodPackageName = $templateProps[\'prodPackageName\'];\\n        if(!empty($templateProps[\'prodClassName\'])) $prodClassName = $templateProps[\'prodClassName\'];\\n        if(!empty($templateProps[\'prodTemplateId\'])) $prodTemplateId = $templateProps[\'prodTemplateId\'];\\n        \\n        $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $prodPackageName . \'\\/model\\/\';\\n        $modx->addPackage($prodPackageName, $modelpath);\\n        \\n        $product = $modx->getObject( $prodClassName, array( \'resource_id\'=>$resourceIdentifier,\'alias\'=>$prod_alias,\'published\'=>true,\'deleted\'=>false ) );\\n        \\n        if($product){\\n            \\n            if(!$product->get(\'template\')) $product->set(\'template\',$prodTemplateId);\\n            $product->set(\'parent\',$resourceIdentifier);\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$product->get(\'id\');\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            \\/\\/\\u0412\\u044b\\u0442\\u0430\\u0441\\u043a\\u0438\\u0432\\u0430\\u0435\\u043c \\u0438\\u0437 \\u043a\\u044d\\u0448\\u0430\\n            if ( is_array($cachedResource) && array_key_exists(\'resource\', $cachedResource) && is_array($cachedResource[\'resource\']) ) {\\n                \\n                $modx->resource = $modx->newObject($cachedResource[\'resourceClass\']);\\n                \\n                if ($modx->resource) {\\n                    \\n                    $modx->resource->fromArray($cachedResource[\'resource\'], \'\', true, true, true);\\n                    $modx->resource->_content = $cachedResource[\'resource\'][\'_content\'];\\n                    $modx->resource->_isForward = isset($cachedResource[\'resource\'][\'_isForward\']) && !empty($cachedResource[\'resource\'][\'_isForward\']);\\n                    \\n                    if (isset($cachedResource[\'elementCache\'])) $modx->elementCache = $cachedResource[\'elementCache\'];\\n                    if (isset($cachedResource[\'sourceCache\'])) $modx->sourceCache = $cachedResource[\'sourceCache\'];\\n                    if ($modx->resource->get(\'_jscripts\')) $modx->jscripts = $modx->jscripts + $modx->resource->get(\'_jscripts\');\\n                    if ($modx->resource->get(\'_sjscripts\')) $modx->sjscripts = $modx->sjscripts + $modx->resource->get(\'_sjscripts\');\\n                    if ($modx->resource->get(\'_loadedjscripts\')) $modx->loadedjscripts = array_merge($modx->loadedjscripts, $modx->resource->get(\'_loadedjscripts\'));\\n                    $isForward = $modx->resource->_isForward;\\n                    $modx->resource->setProcessed(true);\\n                    $fromCache = true;\\n                    \\n                    $modx->invokeEvent(\'OnLoadWebPageCache\');\\n                    \\n                }\\n            \\n            \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0432 \\u043a\\u044d\\u0448\\u0435 \\u043d\\u0435\\u0442, \\u0441\\u043e\\u0437\\u0434\\u0430\\u0451\\u043c \\u043d\\u043e\\u0432\\u044b\\u0439 \\u0432\\u0438\\u0440\\u0442\\u0443\\u0430\\u043b\\u044c\\u043d\\u044b\\u0439 \\u0440\\u0435\\u0441\\u0443\\u0440\\u0441 \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            }else{\\n                \\n                $modx->resource = $modx->newObject(\'modResource\');\\n                \\/\\/$modx->resource->set();\\n                \\n                ####################################################\\n                \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u043f\\u043e\\u043b\\u044f \\u043f\\u043e \\u0442\\u0438\\u043f\\u0430\\u043c \\u0432\\u0432\\u043e\\u0434\\u0430 \\u0441\\u0432\\u044f\\u0437\\u0430\\u043d\\u043d\\u044b\\u0445 TV\\n                $product_fields = $product->toArray();\\n                $field_tv = array();\\n                \\n                $sql = \\"\\n                SELECT `formtabs`\\n                FROM `\\".$modx->config[\'table_prefix\'].\\"migx_configs`\\n                WHERE `name` = \'{$prodPackageName}\'\\n                \\";\\n                $stmt = $modx->prepare($sql);\\n                if ($stmt && $stmt->execute()) {\\n                    $migx_config_formtabs = $stmt->fetchColumn();\\n                    if($migx_config_formtabs){\\n                        $migx_config_formtabs_arr = json_decode($migx_config_formtabs,true);\\n                        foreach($migx_config_formtabs_arr as $formtabs){\\n                            \\n                            if(!empty($formtabs[\'fields\'])){\\n                                $temp_fields = !is_array($formtabs[\'fields\'])? json_decode($formtabs[\'fields\'],true) : $formtabs[\'fields\'];\\n                            }else{\\n                                $temp_fields = array();\\n                            }\\n                            \\n                            foreach($temp_fields as $temp_field){\\n                                if(!empty($temp_field[\'inputTV\'])) $field_tv[$temp_field[\'field\']] = $temp_field[\'inputTV\'];\\n                            }\\n                        }\\n                        \\n                    }\\n                }\\n                $stmt->closeCursor();\\n                \\n                foreach($field_tv as $field_name => $tv_name){\\n                    if(isset($product_fields[$field_name])){\\n                        \\n                        $tv_object = $modx->getObject(\'modTemplateVar\',array(\'name\'=>$tv_name));\\n                        if( is_object($tv_object) ){\\n                            if($tv_object->get(\'display\')==\'default\') continue;\\n                            \\n                            $tv_object->set(\'name\',$field_name);\\n                            $output_properties = array_merge($tv_object->get(\'output_properties\'),array(\'param_name\'=>$field_name,\'id\'=>$product_fields[\'id\']));\\n                            $tv_object->set(\'output_properties\',$output_properties);\\n                            $tv_object->set(\'value\',$product_fields[$field_name]);\\n                            \\n                            $value = $product_fields[$field_name];\\n                            $value = $tv_object->prepareOutput($value);\\n                            $outputRenderPaths = $tv_object->getRenderDirectories(\'OnTVOutputRenderList\',\'output\');\\n                            \\n                            $value = $tv_object->getRender($output_properties,$value,$outputRenderPaths,\'output\',$product_fields[\'id\'],$tv_object->get(\'display\'));\\n                            \\n                            $product_fields[$field_name] = $value;\\n                        }\\n                    }\\n                }\\n                ####################################################\\n                \\n                $modx->resource->fromArray(array_merge($resource->toArray(),$product_fields));\\n                $modx->resource->_fieldMeta = array_merge($resource->_fieldMeta,$product->_fieldMeta);\\n                \\n                $modx->resource->set(\'id\',$product->get(\'id\'));\\n                $modx->resource->set(\'cacheable\',false);\\n                $modx->resource->set(\'class_key\',$prodClassName);\\n                $modx->resource->_content = \'\';\\n                $modx->resource->_output = \'\';\\n                $modx->resource->_isForward = true;\\n                \\/\\/$modx->resource->_class = $prodClassName;\\n                \\n                $modx->elementCache = array();\\n                $modx->resourceGenerated = true;\\n                unset($resource);\\n                \\n            }\\n            \\n            unset($product);\\n            \\n            if($debug){ echo \'<pre>\'.print_r($modx->resource->toArray(),true).\'<\\/pre>\'; exit; }\\n            \\n            \\/\\/\\u041f\\u0440\\u043e\\u0441\\u0447\\u0438\\u0442\\u044b\\u0432\\u0430\\u0435\\u043c \\u0438 \\u0432\\u044b\\u0432\\u043e\\u0434\\u0438\\u043c HTML-\\u043a\\u043e\\u0434 \\u0441\\u0442\\u0440\\u0430\\u043d\\u0438\\u0446\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430\\n            $modx->resourceIdentifier = $modx->resource->get(\'id\');\\n            $modx->resourceMethod = \'id\';\\n            \\n            $modx->request->prepareResponse();\\n            \\n        }\\n        \\n    break;\\n\\n    case \\"OnWebPageComplete\\":\\n        \\n        if(!$prodClassName || $prodClassName == \'modResource\') break;\\n        \\n        $results= array();\\n        if ( is_object($modx->resource) && $modx->resource instanceof modResource && $modx->resource->getProcessed() && $modx->resource->get(\'id\') ) {\\n            \\n            if( $modx->resource->class_key != $prodClassName ) break;\\n            \\n            $cacheKey = \'shk_\'.$prodPackageName.\'\\/\'.$modx->resource->get(\'id\');\\n            \\n            \\/\\/$cacheProvider = $modx->cacheManager->getCacheProvider($modx->cacheManager->getOption(xPDO::OPT_CACHE_KEY, $cacheOptions));\\n            \\/\\/$cachePath = $cacheProvider->getCacheKey( $cacheKey, $cacheOptions );\\n            \\n            $cachedResource = $modx->cacheManager->get( $cacheKey, $cacheOptions );\\n            \\n            if ( !is_array( $cachedResource ) || empty( $cachedResource ) ) {\\n                \\n                $results[\'resourceClass\'] = $modx->resource->_class;\\n                $results[\'resource\'][\'_processed\']= $modx->resource->getProcessed();\\n                $results[\'resource\']= $modx->resource->toArray(\'\', true);\\n                $results[\'resource\'][\'_content\']= $modx->resource->_content;\\n                $results[\'resource\'][\'_isForward\']= $modx->resource->_isForward;\\n                if ($contentType = $modx->resource->getOne(\'ContentType\')) {\\n                    $results[\'contentType\']= $contentType->toArray(\'\', true);\\n                }\\n                $results[\'resourceGroups\']= array();\\n                $context = $modx->resource->_contextKey ? $modx->resource->_contextKey : \'web\';\\n                $policies = $modx->resource->findPolicy($context);\\n                if (is_array($policies)) {\\n                    $results[\'policyCache\']= $policies;\\n                }\\n                if (!empty($modx->elementCache)) {\\n                    $results[\'elementCache\']= $modx->elementCache;\\n                }\\n                if (!empty($modx->sourceCache)) {\\n                    $results[\'sourceCache\']= $modx->sourceCache;\\n                }\\n                if (!empty($modx->resource->_sjscripts)) {\\n                    $results[\'resource\'][\'_sjscripts\']= $modx->resource->_sjscripts;\\n                }\\n                if (!empty($modx->resource->_jscripts)) {\\n                    $results[\'resource\'][\'_jscripts\']= $modx->resource->_jscripts;\\n                }\\n                if (!empty($modx->resource->_loadedjscripts)) {\\n                    $results[\'resource\'][\'_loadedjscripts\']= $modx->resource->_loadedjscripts;\\n                }\\n                \\n                $lifetime = (integer) $modx->cacheManager->getOption(\'cache_resource_expires\', $cacheOptions, $modx->cacheManager->getOption(xPDO::OPT_CACHE_EXPIRES, $cacheOptions, 0));\\n                \\n                if (!$modx->cacheManager->set( $cacheKey, $results, $lifetime, $cacheOptions ) ) {\\n                    $modx->log( modX::LOG_LEVEL_ERROR, \\"[contextSwitch] Could not cache resource \\" . $modx->resource->get(\'id\') );\\n                }\\n                \\n            }\\n            \\n            unset($cachedResource);\\n            \\n        }\\n        \\n    break;\\n\\n}\\n\\nreturn \'\';"}',
        'guid' => '479ae57df20fd9eeb5c65e2c70328146',
        'native_key' => 1,
        'signature' => '444dd38788bd6fd8c08d4da90941c310',
      ),
      '0a68b866ccdfde1f62c7181f14cbb33d' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            'fdaf29fc11b5e1f11a8f3c921b0d18c8' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKChangeStatus","priority":0,"propertyset":0}',
              'guid' => '4c1754b0be94d0d55cc64ffead1f4d54',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKChangeStatus',
              ),
              'signature' => '97a7ad05691df103fd85c88de0936344',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_updateInventory","description":"Update inventory data.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n * shk_updateInventory\\n * \\n * \\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043d\\u043e\\u0432\\u043b\\u044f\\u0435\\u0442 \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430 \\u043d\\u0430 \\u0441\\u043a\\u043b\\u0430\\u0434\\u0435 \\u043f\\u0440\\u0438 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434\\u0435 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430 \\u0432 \\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u043b\\u0435\\u043d\\" (\\u0438\\u043b\\u0438 \\u0434\\u0440.)\\n * \\n * OnSHKChangeStatus\\n *\\/\\n\\n$eventName = $modx->event->name;\\n\\n$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );\\n$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );\\n$context = $modx->getOption( \'context\', $scriptProperties, \'\' );\\n$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );\\nif( !is_array( $order_ids ) ){\\n    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();\\n}\\n$status = $modx->getOption( \'status\', $scriptProperties, \'\' );\\n\\nif( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';\\n\\n$modelpath = $modx->getOption(\'core_path\') . \'components\\/shopkeeper3\\/model\\/\';\\n$modx->addPackage( \'shopkeeper3\', $modelpath );\\n\\nforeach( $order_ids as $order_id ){\\n    \\n    $query = $modx->newQuery( \'shk_purchases\' );\\n    $query->where( array( \'order_id\' => $order_id ) );\\n    $purchases = $modx->getIterator( \'shk_purchases\', $query );\\n    \\n    if( $purchases ){\\n        \\n        foreach( $purchases as $purchase ){\\n            \\n            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){\\n                $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $purchase->package_name . \'\\/model\\/\';\\n                $modx->addPackage( $purchase->package_name, $modelpath );\\n            }\\n            \\n            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );\\n            if( $product ){\\n                \\n                $p_data = $product->toArray();\\n                \\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u044d\\u0442\\u043e \\u043f\\u043e\\u043b\\u0435 \\u043e\\u0441\\u043d\\u043e\\u0432\\u043d\\u043e\\u0439 \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n                if( isset( $p_data[ $inventory_fieldname ] ) ){\\n                    \\n                    $current_inventory = $p_data[ $inventory_fieldname ];\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    $product->set( $inventory_fieldname, $new_inventory );\\n                    $product->save();\\n                    \\n                }\\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0437\\u043d\\u0430\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0445\\u0440\\u0430\\u043d\\u0438\\u0442\\u0441\\u044f \\u0432 TV \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0435\\n                else{\\n                    \\n                    $table_name = \'\';\\n                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {\\n                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';\\n                    }\\n                    if( $table_name != \'site_content\' ) continue;\\n                    \\n                    $context = $p_data[\'context_key\'];\\n                    \\n                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));\\n                    if( !$tv ) continue;\\n                    \\n                    $current_inventory = $tv->getValue( $p_data[\'id\'] );\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    \\/\\/$tv->setValue( $p_data[\'id\'], $new_inventory );\\n                    \\n                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(\\n                        \'tmplvarid\' => $tv->get(\'id\'),\\n                        \'contentid\' => $p_data[\'id\'],\\n                    ),true);\\n                    \\n                    if( $templateVarResource ){\\n                        $templateVarResource->set( \'value\', $new_inventory );\\n                        $templateVarResource->save();\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\n\\n\\/\\/\\u041e\\u0447\\u0438\\u0441\\u0442\\u043a\\u0430 \\u043a\\u044d\\u0448\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0430\\nif( $context ){\\n    $modx->cacheManager->refresh(array(\\n        \'resource\' => array( \'contexts\' => array( $context ) ),\\n    ));\\n}\\n\\nreturn \'\';","locked":0,"properties":"a:3:{s:13:\\"plugin_status\\";a:7:{s:4:\\"name\\";s:13:\\"plugin_status\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:1:\\"2\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:19:\\"inventory_fieldname\\";a:7:{s:4:\\"name\\";s:19:\\"inventory_fieldname\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:9:\\"inventory\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}s:7:\\"context\\";a:7:{s:4:\\"name\\";s:7:\\"context\\";s:4:\\"desc\\";s:0:\\"\\";s:4:\\"type\\";s:9:\\"textfield\\";s:7:\\"options\\";s:0:\\"\\";s:5:\\"value\\";s:3:\\"web\\";s:7:\\"lexicon\\";N;s:4:\\"area\\";s:0:\\"\\";}}","disabled":1,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n * shk_updateInventory\\n * \\n * \\u041f\\u043b\\u0430\\u0433\\u0438\\u043d \\u043e\\u0431\\u043d\\u043e\\u0432\\u043b\\u044f\\u0435\\u0442 \\u043a\\u043e\\u043b\\u0438\\u0447\\u0435\\u0441\\u0442\\u0432\\u043e \\u0442\\u043e\\u0432\\u0430\\u0440\\u0430 \\u043d\\u0430 \\u0441\\u043a\\u043b\\u0430\\u0434\\u0435 \\u043f\\u0440\\u0438 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434\\u0435 \\u0441\\u0442\\u0430\\u0442\\u0443\\u0441\\u0430 \\u0437\\u0430\\u043a\\u0430\\u0437\\u0430 \\u0432 \\"\\u041e\\u0442\\u043f\\u0440\\u0430\\u0432\\u043b\\u0435\\u043d\\" (\\u0438\\u043b\\u0438 \\u0434\\u0440.)\\n * \\n * OnSHKChangeStatus\\n *\\/\\n\\n$eventName = $modx->event->name;\\n\\n$inventory_fieldname = $modx->getOption( \'inventory_fieldname\', $scriptProperties, \'inventory\' );\\n$plugin_status = $modx->getOption( \'plugin_status\', $scriptProperties, \'2\' );\\n$context = $modx->getOption( \'context\', $scriptProperties, \'\' );\\n$order_ids = $modx->getOption( \'order_ids\', $scriptProperties, array() );\\nif( !is_array( $order_ids ) ){\\n    $order_ids = $order_ids && is_numeric( $order_ids ) ? array( $order_ids ) : array();\\n}\\n$status = $modx->getOption( \'status\', $scriptProperties, \'\' );\\n\\nif( empty( $order_ids ) || empty( $status ) || $status != $plugin_status ) return \'\';\\n\\n$modelpath = $modx->getOption(\'core_path\') . \'components\\/shopkeeper3\\/model\\/\';\\n$modx->addPackage( \'shopkeeper3\', $modelpath );\\n\\nforeach( $order_ids as $order_id ){\\n    \\n    $query = $modx->newQuery( \'shk_purchases\' );\\n    $query->where( array( \'order_id\' => $order_id ) );\\n    $purchases = $modx->getIterator( \'shk_purchases\', $query );\\n    \\n    if( $purchases ){\\n        \\n        foreach( $purchases as $purchase ){\\n            \\n            if( $purchase->package_name && $purchase->package_name != \'modResource\' && !in_array( $purchase->package_name, array_keys($modx->packages) ) ){\\n                $modelpath = $modx->getOption(\'core_path\') . \'components\\/\' . $purchase->package_name . \'\\/model\\/\';\\n                $modx->addPackage( $purchase->package_name, $modelpath );\\n            }\\n            \\n            $product = $modx->getObject( $purchase->class_name, $purchase->p_id );\\n            if( $product ){\\n                \\n                $p_data = $product->toArray();\\n                \\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u044d\\u0442\\u043e \\u043f\\u043e\\u043b\\u0435 \\u043e\\u0441\\u043d\\u043e\\u0432\\u043d\\u043e\\u0439 \\u0442\\u0430\\u0431\\u043b\\u0438\\u0446\\u044b\\n                if( isset( $p_data[ $inventory_fieldname ] ) ){\\n                    \\n                    $current_inventory = $p_data[ $inventory_fieldname ];\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    $product->set( $inventory_fieldname, $new_inventory );\\n                    $product->save();\\n                    \\n                }\\n                \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u0437\\u043d\\u0430\\u0447\\u0435\\u043d\\u0438\\u0435 \\u0445\\u0440\\u0430\\u043d\\u0438\\u0442\\u0441\\u044f \\u0432 TV \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u0435\\n                else{\\n                    \\n                    $table_name = \'\';\\n                    if ( $className = $modx->loadClass( $purchase->class_name ) ) {\\n                        $table_name = isset( $modx->map[$className][\'table\'] ) ? $modx->map[$className][\'table\'] : \'\';\\n                    }\\n                    if( $table_name != \'site_content\' ) continue;\\n                    \\n                    $context = $p_data[\'context_key\'];\\n                    \\n                    $tv = $modx->getObject( \'modTemplateVar\', array( \'name\' => $inventory_fieldname ));\\n                    if( !$tv ) continue;\\n                    \\n                    $current_inventory = $tv->getValue( $p_data[\'id\'] );\\n                    $current_inventory = $current_inventory ? floatval( $current_inventory ) : 0;\\n                    if( !$current_inventory ) continue;\\n                    \\n                    $new_inventory = $current_inventory - $purchase->count;\\n                    if( $new_inventory < 0 ) $new_inventory = 0;\\n                    \\n                    \\/\\/$tv->setValue( $p_data[\'id\'], $new_inventory );\\n                    \\n                    $templateVarResource = $modx->getObject(\'modTemplateVarResource\',array(\\n                        \'tmplvarid\' => $tv->get(\'id\'),\\n                        \'contentid\' => $p_data[\'id\'],\\n                    ),true);\\n                    \\n                    if( $templateVarResource ){\\n                        $templateVarResource->set( \'value\', $new_inventory );\\n                        $templateVarResource->save();\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n    }\\n    \\n}\\n\\n\\n\\/\\/\\u041e\\u0447\\u0438\\u0441\\u0442\\u043a\\u0430 \\u043a\\u044d\\u0448\\u0430 \\u0441\\u0430\\u0439\\u0442\\u0430\\nif( $context ){\\n    $modx->cacheManager->refresh(array(\\n        \'resource\' => array( \'contexts\' => array( $context ) ),\\n    ));\\n}\\n\\nreturn \'\';"}',
        'guid' => 'd3749641e25d402337e8b632c31e66ae',
        'native_key' => 1,
        'signature' => '13589f897c1d71c9a4e4890e5deb70d2',
      ),
      '788fd364ab1dbc937761fb7501cc977e' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '300f2c6517de54745fce5395f90da446' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVInputRenderList","priority":0,"propertyset":0}',
              'guid' => '09bc5640d92a4142d11d18dc1357bb71',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVInputRenderList',
              ),
              'signature' => 'b9cd2a950d4fb5d7cdada3d00f486821',
            ),
            '65ee404e45c5e71e070a52fa5e014425' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVInputPropertiesList","priority":0,"propertyset":0}',
              'guid' => '51e9d2597ba637fea2c1250b07fced53',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVInputPropertiesList',
              ),
              'signature' => '0c6ff1ba7f32feb568a49e9fda42a83d',
            ),
            'ee3d144e4f0792043ed42774d065520e' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVOutputRenderList","priority":0,"propertyset":0}',
              'guid' => 'ce725b2672b9bd42c9d318b3a50d4c00',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVOutputRenderList',
              ),
              'signature' => '657bcab4bf8af1eacf9bf04eb57ddf3c',
            ),
            'a2cc1d1f77fad484c83785947767008a' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnTVOutputRenderPropertiesList","priority":0,"propertyset":0}',
              'guid' => '9ef1fb010f4770ee4c94af7a07e99980',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnTVOutputRenderPropertiesList',
              ),
              'signature' => '409b9b16a47a64b2c0144927ae8f22ae',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_tv_input_output","description":"Print Shopkeeper`s input and output types for TV.","editor_type":0,"category":0,"cache_type":0,"plugincode":"$corePath = MODX_CORE_PATH.\'components\\/shopkeeper3\\/\';\\n\\nswitch ($modx->event->name) {\\n    \\/\\/tv input\\n    case \'OnTVInputRenderList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/shk_mgr.js\');\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/widgets\\/shk.grid.js\');\\n        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/css\\/mgr.css\');\\n        $modx->event->output($corePath.\'elements\\/tv\\/input\\/\');\\n    break;\\n    case \'OnTVInputPropertiesList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->event->output($corePath.\'elements\\/tv\\/inputproperties\\/\');\\n    break;\\n    \\/\\/tv output\\n    case \'OnTVOutputRenderList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/output\\/\');\\n    break;\\n    case \'OnTVOutputRenderPropertiesList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/outputproperties\\/\');\\n    break;\\n}\\n\\nreturn;","locked":0,"properties":null,"disabled":0,"moduleguid":"","static":0,"static_file":"","content":"$corePath = MODX_CORE_PATH.\'components\\/shopkeeper3\\/\';\\n\\nswitch ($modx->event->name) {\\n    \\/\\/tv input\\n    case \'OnTVInputRenderList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/shk_mgr.js\');\\n        $modx->regClientStartupScript($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/js\\/widgets\\/shk.grid.js\');\\n        $modx->regClientCSS($modx->getOption(\'assets_url\').\'components\\/shopkeeper3\\/mgr\\/css\\/mgr.css\');\\n        $modx->event->output($corePath.\'elements\\/tv\\/input\\/\');\\n    break;\\n    case \'OnTVInputPropertiesList\':\\n        if($modx->context->get(\'key\') != \'mgr\') return;\\n        $modx->event->output($corePath.\'elements\\/tv\\/inputproperties\\/\');\\n    break;\\n    \\/\\/tv output\\n    case \'OnTVOutputRenderList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/output\\/\');\\n    break;\\n    case \'OnTVOutputRenderPropertiesList\':\\n        $modx->event->output($corePath.\'elements\\/tv\\/outputproperties\\/\');\\n    break;\\n}\\n\\nreturn;"}',
        'guid' => '9eb5ad05dd4631045690b86c1744a2ae',
        'native_key' => 1,
        'signature' => '05eb178236001c1bafe0490747f96c57',
      ),
      'bb366a5098ddec15ccbe82b9fda9c483' => 
      array (
        'preserve_keys' => false,
        'update_object' => true,
        'unique_key' => 'name',
        'related_objects' => 
        array (
          'PluginEvents' => 
          array (
            '4a4e414a46418e52a329338afd264c05' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnLoadWebDocument","priority":0,"propertyset":0}',
              'guid' => 'c46bef9cb7f01bd0aba7a2240fd57a94',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnLoadWebDocument',
              ),
              'signature' => 'd6f43ca80de7c44e8534a24c90a3496c',
            ),
            '5d20d1d06ddfd2640ae27ae848242698' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetProductPrice","priority":0,"propertyset":0}',
              'guid' => '20bc9e8506d38ca1cd3d7cc3da8564ea',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetProductPrice',
              ),
              'signature' => 'cefa2317fc5e20415abdbec437f3af96',
            ),
            'c1d206728e3ab1831a3c15bdf1790245' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetProductAdditParamPrice","priority":0,"propertyset":0}',
              'guid' => '1e5b16d00171ec723e1ed616f31d8fcc',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetProductAdditParamPrice',
              ),
              'signature' => 'c0b93ee90a823485a5c1fea4c06b5180',
            ),
            '8892a94fec8df3164bb1688a1553260f' => 
            array (
              'class' => 'modPluginEvent',
              'object' => '{"pluginid":0,"event":"OnSHKgetDeliveryPrice","priority":0,"propertyset":0}',
              'guid' => '52345764ff5806666c96508ad7f46573',
              'native_key' => 
              array (
                0 => 0,
                1 => 'OnSHKgetDeliveryPrice',
              ),
              'signature' => '48f8c1502922753836e59db2c8d3299b',
            ),
          ),
        ),
        'related_object_attributes' => 
        array (
          'PluginEvents' => 
          array (
            'preserve_keys' => true,
            'update_object' => false,
            'unique_key' => 
            array (
              0 => 'pluginid',
              1 => 'event',
            ),
          ),
        ),
        'class' => 'modPlugin',
        'object' => '{"id":1,"source":1,"property_preprocess":0,"name":"shk_multicurrency","description":"Multicurrency in store.","editor_type":0,"category":0,"cache_type":0,"plugincode":"\\/*\\n plugin shk_multicurrency\\n System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice\\n\\n<div>\\n    \\u0412\\u0430\\u043b\\u044e\\u0442\\u0430:\\n    <select id=\\"site_currency\\" name=\\"curency\\">\\n        <option value=\\"1\\">\\u0440\\u0443\\u0431.<\\/option>\\n        <option value=\\"2\\">\\u0433\\u0440\\u043d.<\\/option>\\n        <option value=\\"3\\">USD<\\/option>\\n        <option value=\\"4\\">euro<\\/option>\\n    <\\/select>\\n<\\/div>\\n\\n*\\/\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\nswitch($modx->event->name){\\n    \\n    case \'OnLoadWebDocument\':\\n        \\n        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';\\n        \\n        if(empty($scriptProperties[\'noScript\'])){\\n            \\n            $script_str = \'\\n            <script type=\\"text\\/javascript\\">\\n                var shk_cindex = document.cookie.indexOf(\\"shk_currency=\\") > -1 ? document.cookie.indexOf(\\"shk_currency=\\") + new String(\\"shk_currency=\\").length : -1;\\n                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;\\n                jQuery(\\"#site_currency\\")\\n                .val(shk_currency)\\n                .bind(\\"change\\",function(){\\n                    var loc_href = window.location.pathname+document.location.search;\\n                    window.location.href = loc_href+(loc_href.indexOf(\\"?\\") > -1 ? \\"&\\" : \\"?\\") + \\"scurr=\\" + this.value;\\n                });\\n            <\\/script>\\n            \';\\n            $modx->regClientScript( $script_str, true );\\n        }\\n        \\n        if( isset( $_GET[\'scurr\'] ) ){\\n            \\n            if( $currency_id != $shk_currency ){\\n                \\n                require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                \\n                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );\\n                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                $conf_delivery = $config[\'delivery\'];\\n                \\n            }\\n            \\n            $_SESSION[\'shk_curr_rate\'] = null;\\n            unset($_SESSION[\'shk_curr_rate\']);\\n            \\n            \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n            if( !empty( $conf_delivery ) ){\\n                \\n                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';\\n                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;\\n                $_SESSION[\'shk_delivery\'] = array();\\n                \\n                foreach( $conf_delivery as $opt ){\\n                    \\n                    if( $opt[\'label\'] == $delivery_label ){\\n                        \\n                        $_SESSION[\'shk_delivery\'] = array(\\n                            \'label\' => $opt[\'label\'],\\n                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,\\n                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),\\n                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),\\n                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )\\n                        );\\n                        \\n                        break;\\n                    }\\n                    \\n                }\\n                \\n                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );\\n                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];\\n                }\\n                \\n            }\\n            \\n            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();\\n            \\n            if( !empty( $scriptProperties[\'currency_rate\'] ) ){\\n                \\n                \\/\\/\\u0418\\u0437\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u0446\\u0435\\u043d\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432 \\u0432 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0435\\n                if( !empty( $purchases ) ){\\n                    \\n                    foreach( $purchases as $key => &$purchase ){\\n                        \\n                        if( isset( $purchase[\'old_price\'] ) ){\\n                            $base_price = $purchase[\'old_price\'];\\n                        }\\n                        else if( !isset( $purchase[\'old_price\'] ) ) {\\n                            $purchase[\'old_price\'] = $purchase[\'price\'];\\n                            $base_price = $purchase[\'price\'];\\n                        }\\n                        \\n                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );\\n                        \\n                        \\/\\/\\u0414\\u043e\\u043f. \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n                        if( !empty( $purchase[\'options\'] ) ){\\n                            foreach( $purchase[\'options\'] as &$addit_param ){\\n                                \\n                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];\\n                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );\\n                                \\n                            }\\n                        }\\n                        \\n                    }\\n                    \\n                    $_SESSION[\'shk_order\'] = $purchases;\\n                    \\n                }else{\\n                    \\n                    \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0435\\u0442 \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432, \\u043f\\u0440\\u043e\\u0441\\u0442\\u043e \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\n                    shk_currency_calc( $scriptProperties, 0, $currency_id );\\n                    \\n                }\\n                \\n                $shk_currency = $currency_id;\\n                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, \\"\\/\\" );\\n                \\n                \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u0435 \\u0432\\u0430\\u043b\\u044e\\u0442\\u044b\\n                $currency_name = \'\';\\n                foreach( $scriptProperties[\'currency_rate\'] as $rt ){\\n                    if( $rt[\'id\'] == $currency_id ){\\n                        $currency_name = $rt[\'label\'];\\n                        break;\\n                    }\\n                }\\n                $_SESSION[\'shk_currency_name\'] = $currency_name;\\n                \\n            }\\n            \\n            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');\\n            if( $modx->config[\'friendly_urls\'] ){\\n                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );\\n            }\\n            \\n            $modx->sendRedirect( $back_url, 0 );\\n            \\n        }\\n        \\n        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';\\n        if( !$currency_name ){\\n            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');\\n        }\\n        $modx->setPlaceholder( \'shk_currency\', $currency_name );\\n        \\n    break;\\n    case \'OnSHKgetProductAdditParamPrice\':\\n    case \'OnSHKgetDeliveryPrice\':\\n    case \'OnSHKgetProductPrice\':\\n        \\n        $output = $modx->getOption( \'price\', $scriptProperties, 0 );\\n        \\n        if( is_numeric( $output ) ){\\n            \\n            \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n            $output = shk_currency_calc( $scriptProperties, $output, $currency_id );\\n            \\n            $modx->event->_output = \'\';\\n            $modx->event->output( $output );\\n            \\n        }else{\\n            $modx->event->output( false );\\n        }\\n        \\n    break;\\n    \\n}\\n\\nreturn \'\';","locked":0,"properties":null,"disabled":1,"moduleguid":"","static":0,"static_file":"","content":"\\/*\\n plugin shk_multicurrency\\n System event: OnLoadWebDocument, OnSHKgetProductPrice, OnSHKgetProductAdditParamPrice, OnSHKgetDeliveryPrice\\n\\n<div>\\n    \\u0412\\u0430\\u043b\\u044e\\u0442\\u0430:\\n    <select id=\\"site_currency\\" name=\\"curency\\">\\n        <option value=\\"1\\">\\u0440\\u0443\\u0431.<\\/option>\\n        <option value=\\"2\\">\\u0433\\u0440\\u043d.<\\/option>\\n        <option value=\\"3\\">USD<\\/option>\\n        <option value=\\"4\\">euro<\\/option>\\n    <\\/select>\\n<\\/div>\\n\\n*\\/\\n\\n$scriptProperties = array_merge(\\n    array(\\n        \'currency_default\' => $modx->getOption( \'shk3.currency_default\', null, 1 ),\\n        \'currency_selected\' => $modx->getOption( \'shk3.currency_selected\', null, 0 )\\n    ),\\n    $scriptProperties\\n);\\n\\n$shk_currency = !empty($_COOKIE[\'shk_currency\']) && is_numeric($_COOKIE[\'shk_currency\']) ? abs(intval($_COOKIE[\'shk_currency\'])) : $scriptProperties[\'currency_default\'];\\n\\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0443\\u0436\\u0435\\u043d \\u0432\\u0441\\u0435\\u0433\\u0434\\u0430 \\u043f\\u0440\\u0435\\u0435\\u0432\\u043e\\u0434 \\u0432 \\u043e\\u0434\\u043d\\u0443 \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\nif( !empty( $scriptProperties[\'currency_selected\'] ) && $shk_currency != $scriptProperties[\'currency_selected\'] ){\\n    setcookie( \'shk_currency\', intval($scriptProperties[\'currency_selected\']), time()+3600*24, \\"\\/\\" );\\n    $shk_currency = intval($scriptProperties[\'currency_selected\']);\\n}\\n$currency_id = isset($_GET[\'scurr\']) && is_numeric($_GET[\'scurr\']) ? intval($_GET[\'scurr\']) : $shk_currency;\\n\\nif(!function_exists(\'shk_currency_calc\')){\\n    function shk_currency_calc($properties, $base_price, $currency_id, $rate_ratio = 0){\\n        \\n        $inverse = isset($properties[\'inverse\']) ? $properties[\'inverse\'] : false;\\/\\/\\u043e\\u0431\\u0440\\u0430\\u0442\\u043d\\u044b\\u0439 \\u043f\\u0435\\u0440\\u0435\\u0432\\u043e\\u0434 \\u0446\\u0435\\u043d\\u044b\\n        \\n        if( !$rate_ratio ){\\n            \\n            if( isset( $_SESSION[\'shk_curr_rate\'] ) && is_numeric( $_SESSION[\'shk_curr_rate\'] ) && !$inverse ){\\n                \\n                $rate_ratio = $_SESSION[\'shk_curr_rate\'];\\n                \\n            }else{\\n                \\n                if( !isset( $properties[\'currency_rate\'] ) ){\\n                    require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                    $config = Shopkeeper::getConfig( array(\'currency_rate\') );\\n                    $properties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                }\\n                \\n                $rate_ratio = 1;\\n                \\n                if( $properties[\'currency_default\'] != $currency_id ){\\n                    \\n                    $rate_default = 1;\\n                    $rate = 1;\\n                    \\/\\/\\u041e\\u043f\\u0440\\u0435\\u0434\\u0435\\u043b\\u044f\\u0435\\u043c \\u043a\\u0443\\u0440\\u0441 \\u043f\\u043e \\u0443\\u043c\\u043e\\u043b\\u0447\\u0430\\u043d\\u0438\\u044e \\u0438 \\u043d\\u043e\\u0432\\u044b\\u0439 \\u043a\\u0443\\u0440\\u0441\\n                    foreach( $properties[\'currency_rate\'] as $rt ){\\n                        if( $rt[\'id\'] == $properties[\'currency_default\'] ){\\n                            $rate_default = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                        else if( $rt[\'id\'] == $currency_id ){\\n                            $rate = Shopkeeper::cleanNumber( $rt[\'value\'], \'float\' );\\n                        }\\n                    }\\n                    \\n                    if( !$inverse ){\\n                        $rate_ratio = $rate_default \\/ $rate;\\n                        $_SESSION[\'shk_curr_rate\'] = $rate_ratio;\\n                    }else{\\n                        $rate_ratio = $rate \\/ $rate_default;\\n                    }\\n                    \\n                }\\n                \\n            }\\n            \\n        }\\n        \\n        \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n        if( $rate_ratio ){\\n            \\n            $price = $base_price * $rate_ratio;\\n            $price = round( $price, ( ceil( $price ) == $price ? 0 : 2 ) );\\n            return $price;\\n        \\n        }else{\\n            return $base_price;\\n        }\\n        \\n    }\\n}\\n\\nswitch($modx->event->name){\\n    \\n    case \'OnLoadWebDocument\':\\n        \\n        if( !empty( $modx->placeholders[\'shk_currency\'] ) ) return \'\';\\n        \\n        if(empty($scriptProperties[\'noScript\'])){\\n            \\n            $script_str = \'\\n            <script type=\\"text\\/javascript\\">\\n                var shk_cindex = document.cookie.indexOf(\\"shk_currency=\\") > -1 ? document.cookie.indexOf(\\"shk_currency=\\") + new String(\\"shk_currency=\\").length : -1;\\n                var shk_currency = shk_cindex > -1 ? document.cookie.substring(shk_cindex,shk_cindex+1) : 1;\\n                jQuery(\\"#site_currency\\")\\n                .val(shk_currency)\\n                .bind(\\"change\\",function(){\\n                    var loc_href = window.location.pathname+document.location.search;\\n                    window.location.href = loc_href+(loc_href.indexOf(\\"?\\") > -1 ? \\"&\\" : \\"?\\") + \\"scurr=\\" + this.value;\\n                });\\n            <\\/script>\\n            \';\\n            $modx->regClientScript( $script_str, true );\\n        }\\n        \\n        if( isset( $_GET[\'scurr\'] ) ){\\n            \\n            if( $currency_id != $shk_currency ){\\n                \\n                require_once MODX_CORE_PATH . \\"components\\/shopkeeper3\\/model\\/shopkeeper.class.php\\";\\n                \\n                $config = Shopkeeper::getConfig( array( \'currency_rate\', \'delivery\' ) );\\n                $scriptProperties[\'currency_rate\'] = $config[\'currency_rate\'];\\n                $conf_delivery = $config[\'delivery\'];\\n                \\n            }\\n            \\n            $_SESSION[\'shk_curr_rate\'] = null;\\n            unset($_SESSION[\'shk_curr_rate\']);\\n            \\n            \\/\\/\\u0414\\u043e\\u0441\\u0442\\u0430\\u0432\\u043a\\u0430\\n            if( !empty( $conf_delivery ) ){\\n                \\n                $delivery_label = !empty( $_SESSION[\'shk_delivery\'][\'label\'] ) ? $_SESSION[\'shk_delivery\'][\'label\'] : \'\';\\n                $delivery_price = !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ? $_SESSION[\'shk_delivery\'][\'price\'] : 0;\\n                $_SESSION[\'shk_delivery\'] = array();\\n                \\n                foreach( $conf_delivery as $opt ){\\n                    \\n                    if( $opt[\'label\'] == $delivery_label ){\\n                        \\n                        $_SESSION[\'shk_delivery\'] = array(\\n                            \'label\' => $opt[\'label\'],\\n                            \'price\' => $delivery_price > 0 ? Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ) : 0,\\n                            \'old_price\' => Shopkeeper::cleanNumber( $opt[\'price\'], \'float\' ),\\n                            \'free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' ),\\n                            \'old_free_start\' => Shopkeeper::cleanNumber( $opt[\'free_start\'], \'float\' )\\n                        );\\n                        \\n                        break;\\n                    }\\n                    \\n                }\\n                \\n                if( !empty( $_SESSION[\'shk_delivery\'][\'price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'old_price\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'old_price\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'old_price\'], $currency_id );\\n                }\\n                if( !empty( $_SESSION[\'shk_delivery\'][\'free_start\'] ) ){\\n                    $_SESSION[\'shk_delivery\'][\'free_start\'] = shk_currency_calc( $scriptProperties, $_SESSION[\'shk_delivery\'][\'free_start\'], $currency_id );\\n                    $_SESSION[\'shk_delivery\'][\'old_free_start\'] = $_SESSION[\'shk_delivery\'][\'free_start\'];\\n                }\\n                \\n            }\\n            \\n            $purchases = !empty( $_SESSION[\'shk_order\'] ) ? $_SESSION[\'shk_order\'] : array();\\n            \\n            if( !empty( $scriptProperties[\'currency_rate\'] ) ){\\n                \\n                \\/\\/\\u0418\\u0437\\u043c\\u0435\\u043d\\u044f\\u0435\\u043c \\u0446\\u0435\\u043d\\u044b \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432 \\u0432 \\u043a\\u043e\\u0440\\u0437\\u0438\\u043d\\u0435\\n                if( !empty( $purchases ) ){\\n                    \\n                    foreach( $purchases as $key => &$purchase ){\\n                        \\n                        if( isset( $purchase[\'old_price\'] ) ){\\n                            $base_price = $purchase[\'old_price\'];\\n                        }\\n                        else if( !isset( $purchase[\'old_price\'] ) ) {\\n                            $purchase[\'old_price\'] = $purchase[\'price\'];\\n                            $base_price = $purchase[\'price\'];\\n                        }\\n                        \\n                        $purchase[\'price\'] = shk_currency_calc( $scriptProperties, $base_price, $currency_id );\\n                        \\n                        \\/\\/\\u0414\\u043e\\u043f. \\u043f\\u0430\\u0440\\u0430\\u043c\\u0435\\u0442\\u0440\\u044b\\n                        if( !empty( $purchase[\'options\'] ) ){\\n                            foreach( $purchase[\'options\'] as &$addit_param ){\\n                                \\n                                if( !isset( $addit_param[3] ) ) $addit_param[3] = $addit_param[1];\\n                                $addit_param[1] = shk_currency_calc( $scriptProperties, $addit_param[3], $currency_id );\\n                                \\n                            }\\n                        }\\n                        \\n                    }\\n                    \\n                    $_SESSION[\'shk_order\'] = $purchases;\\n                    \\n                }else{\\n                    \\n                    \\/\\/\\u0415\\u0441\\u043b\\u0438 \\u043d\\u0435\\u0442 \\u0442\\u043e\\u0432\\u0430\\u0440\\u043e\\u0432, \\u043f\\u0440\\u043e\\u0441\\u0442\\u043e \\u043f\\u0435\\u0440\\u0435\\u043a\\u043b\\u044e\\u0447\\u0430\\u0435\\u043c \\u0432\\u0430\\u043b\\u044e\\u0442\\u0443\\n                    shk_currency_calc( $scriptProperties, 0, $currency_id );\\n                    \\n                }\\n                \\n                $shk_currency = $currency_id;\\n                setcookie( \'shk_currency\', $shk_currency, time()+3600*24, \\"\\/\\" );\\n                \\n                \\/\\/\\u0421\\u043e\\u0445\\u0440\\u0430\\u043d\\u044f\\u0435\\u043c \\u043d\\u0430\\u0437\\u0432\\u0430\\u043d\\u0438\\u0435 \\u0432\\u0430\\u043b\\u044e\\u0442\\u044b\\n                $currency_name = \'\';\\n                foreach( $scriptProperties[\'currency_rate\'] as $rt ){\\n                    if( $rt[\'id\'] == $currency_id ){\\n                        $currency_name = $rt[\'label\'];\\n                        break;\\n                    }\\n                }\\n                $_SESSION[\'shk_currency_name\'] = $currency_name;\\n                \\n            }\\n            \\n            $back_url = !empty($_SERVER[\'HTTP_REFERER\']) ? $_SERVER[\'HTTP_REFERER\'] : $modx->makeURL($modx->resource->get(\'parent\'),\'\',\'\',\'abs\');\\n            if( $modx->config[\'friendly_urls\'] ){\\n                if( strpos($back_url,\'?\') !== false ) $back_url = substr( $back_url, 0, strpos($back_url,\'?\') );\\n            }\\n            \\n            $modx->sendRedirect( $back_url, 0 );\\n            \\n        }\\n        \\n        $currency_name = !empty($_SESSION[\'shk_currency_name\']) ? $_SESSION[\'shk_currency_name\'] : \'\';\\n        if( !$currency_name ){\\n            $currency_name = $modx->getOption(\'shk3.currency\',null,\'\');\\n        }\\n        $modx->setPlaceholder( \'shk_currency\', $currency_name );\\n        \\n    break;\\n    case \'OnSHKgetProductAdditParamPrice\':\\n    case \'OnSHKgetDeliveryPrice\':\\n    case \'OnSHKgetProductPrice\':\\n        \\n        $output = $modx->getOption( \'price\', $scriptProperties, 0 );\\n        \\n        if( is_numeric( $output ) ){\\n            \\n            \\/\\/\\u0421\\u0447\\u0438\\u0442\\u0430\\u0435\\u043c \\u0446\\u0435\\u043d\\u0443 \\u043f\\u043e \\u043a\\u0443\\u0440\\u0441\\u0443\\n            $output = shk_currency_calc( $scriptProperties, $output, $currency_id );\\n            \\n            $modx->event->_output = \'\';\\n            $modx->event->output( $output );\\n            \\n        }else{\\n            $modx->event->output( false );\\n        }\\n        \\n    break;\\n    \\n}\\n\\nreturn \'\';"}',
        'guid' => 'e1bfc53463e56304bedef6e206cc1a62',
        'native_key' => 1,
        'signature' => '77ed72cc1cae1112c523f25ce1f45194',
      ),
    ),
  ),
  'related_object_attributes' => 
  array (
    'Snippets' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Chunks' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'TemplateVars' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
    ),
    'Plugins' => 
    array (
      'preserve_keys' => false,
      'update_object' => true,
      'unique_key' => 'name',
      'related_objects' => true,
      'related_object_attributes' => 
      array (
        'PluginEvents' => 
        array (
          'preserve_keys' => true,
          'update_object' => false,
          'unique_key' => 
          array (
            0 => 'pluginid',
            1 => 'event',
          ),
        ),
      ),
    ),
  ),
  'namespace' => 'shopkeeper3',
  'resolve' => 
  array (
    0 => 
    array (
      'type' => 'file',
      'body' => '{"source":"shopkeeper3-3.2.5-pl\\/modCategory\\/7fd019971236fa72839728a491a86a6e\\/0\\/","target":"return MODX_CORE_PATH . \'components\\/\';","name":"shopkeeper3"}',
    ),
    1 => 
    array (
      'type' => 'file',
      'body' => '{"source":"shopkeeper3-3.2.5-pl\\/modCategory\\/7fd019971236fa72839728a491a86a6e\\/1\\/","target":"return MODX_ASSETS_PATH . \'components\\/\';","name":"shopkeeper3"}',
    ),
    2 => 
    array (
      'type' => 'php',
      'body' => '{"source":"shopkeeper3-3.2.5-pl\\/modCategory\\/7fd019971236fa72839728a491a86a6e.resolve.tables.resolver","type":"php","name":"resolve.tables"}',
    ),
  ),
  'validate' => NULL,
  'vehicle_package' => 'transport',
  'vehicle_class' => 'xPDOObjectVehicle',
  'guid' => '41e7cbee22704574e8a8c34f9cee75fe',
  'package' => 'modx',
  'class' => 'modCategory',
  'signature' => '7fd019971236fa72839728a491a86a6e',
  'native_key' => 1,
  'object' => '{"id":1,"parent":0,"category":"Shopkeeper3","rank":0}',
);